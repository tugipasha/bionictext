
<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BionicText AI</title>
  <script src="https://cdn.tailwindcss.com"></script><!-- Firebase -->
  <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDHVblObPcwznJ3nL0g7s8NFhca7QXBpo4",
            authDomain: "tubitak-cb01f.firebaseapp.com",
            projectId: "tubitak-cb01f",
            storageBucket: "tubitak-cb01f.firebasestorage.app",
            messagingSenderId: "93431831930",
            appId: "1:93431831930:web:d55f61f811a5fae5ee8ac3",
            measurementId: "G-LC5V37BRTD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignUp = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseAuthStateChanged = onAuthStateChanged;
        window.firebaseAddDoc = addDoc;
        window.firebaseGetDocs = getDocs;
        window.firebaseCollection = collection;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseOrderBy = orderBy;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
    </script>
  <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a2b4c',
                        secondary: '#ffffff'
                    }
                }
            }
        }
    </script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .bionic-text { font-weight: 400; }
        .bionic-text .bold { font-weight: 700; color: #1a2b4c; }
        .bionic-bold {
            font-weight: 700; /* sadece o kÄ±smÄ± kalÄ±n yap */
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar { transition: width 0.3s ease; }
        .modal { backdrop-filter: blur(10px); }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gray-50 min-h-screen"><!-- Navigation -->
  <nav class="bg-primary shadow-lg">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
     <div class="flex items-center">
      <div class="flex-shrink-0">
       <h1 class="text-white text-xl font-bold">BionicText AI</h1>
      </div>
      <div class="hidden md:block ml-10">
       <div class="flex items-baseline space-x-4"><button onclick="showSection('home')" class="nav-btn text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_home">Ana Sayfa</button> <button onclick="showSection('test')" class="nav-btn text-gray-300 hover:text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_test">Test</button> <button onclick="showSection('converter')" class="nav-btn text-gray-300 hover:text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_converter">DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼</button> <button onclick="showSection('assistant')" class="nav-btn text-gray-300 hover:text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_assistant">AI Asistan</button> <button onclick="showSection('profile')" class="nav-btn text-gray-300 hover:text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_profile">Profil</button> <button onclick="showSection('settings')" class="nav-btn text-gray-300 hover:text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" data-translate="nav_settings">Ayarlar</button>
       </div>
      </div>
     </div>
     <div class="flex items-center space-x-4"><!-- Language Selector -->
      <div class="relative"><select id="languageSelector" onchange="changeLanguage()" class="bg-white text-primary px-3 py-2 rounded-lg text-sm font-medium border-0 focus:ring-2 focus:ring-blue-300 cursor-pointer"> <option value="en">ðŸ‡ºðŸ‡¸ English</option> <option value="tr" selected>ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</option> <option value="it">   ðŸ‡¹ Italiano</option> </select>
      </div><!-- Login Button (shown when not logged in) -->
      <div id="authButtons"><button onclick="showAuth()" class="bg-white text-primary px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors" data-translate="login">Login</button>
      </div><!-- Profile Menu (shown when logged in) -->
      <div id="userMenu" class="hidden relative"><button onclick="toggleProfileMenu()" class="flex items-center space-x-2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-2 rounded-lg transition-colors">
        <div class="w-8 h-8 bg-white bg-opacity-30 rounded-full flex items-center justify-center"><span id="userInitialsNav" class="text-sm font-semibold">U</span>
        </div><span id="userNameNav" class="text-sm font-medium hidden md:block">User</span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg></button> <!-- Dropdown Menu -->
       <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
        <div class="p-4 border-b border-gray-200">
         <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center"><span id="userInitialsDropdown" class="text-white font-semibold">U</span>
          </div>
          <div>
           <div id="userNameDropdown" class="font-medium text-gray-900">
            User
           </div>
           <div id="userEmailDropdown" class="text-sm text-gray-500">
            user@example.com
           </div>
          </div>
         </div>
        </div>
        <div class="py-2"><button onclick="showSection('profile'); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg><span data-translate="profile_menu_profile">My Profile</span> </button> <button onclick="showSection('test'); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg><span data-translate="profile_menu_test">Take Reading Test</span> </button> <button onclick="showSection('converter'); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg><span data-translate="profile_menu_converter">Convert Text</span> </button> <button onclick="showSection('assistant'); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg><span data-translate="profile_menu_assistant">AI Assistant</span> </button>
         <div class="border-t border-gray-200 mt-2 pt-2"><button onclick="exportAllData(); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3">
           <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
           </svg><span data-translate="profile_menu_export">Export Data</span> </button> <button onclick="logout(); closeProfileMenu()" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-3">
           <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
           </svg><span data-translate="profile_menu_logout">Sign Out</span> </button>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </nav><!-- Authentication Modal -->
  <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50 flex items-center justify-center">
   <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl">
    <div class="text-center mb-6">
     <h2 class="text-2xl font-bold text-primary mb-2" data-translate="auth_welcome">Welcome Back</h2>
     <p class="text-gray-600" data-translate="auth_signin_subtitle">Sign in to your account</p>
    </div>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="auth_email">Email</label> <input type="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all" data-translate-placeholder="auth_email_placeholder" placeholder="Enter your email">
     </div>
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="auth_password">Password</label>
      <div class="relative"><input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all pr-12" data-translate-placeholder="auth_password_placeholder" placeholder="Enter your password"> <button onclick="togglePassword()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg></button>
      </div>
     </div>
    </div><button onclick="login()" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors mt-6" data-translate="auth_signin">Sign In</button>
    <div class="text-center mt-4"><span class="text-gray-600" data-translate="auth_no_account">Don't have an account? </span> <button onclick="toggleAuthMode()" class="text-primary font-medium hover:underline" data-translate="auth_signup">Sign up</button>
    </div><button onclick="closeAuth()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
     </svg></button>
   </div>
  </div><!-- Main Content --> <!-- Notification Toast -->
  <div id="notification" class="fixed top-4 right-4 z-50 hidden">
   <div class="bg-white border-l-4 border-blue-500 rounded-lg shadow-lg p-4 max-w-sm">
    <div class="flex items-center">
     <div class="flex-shrink-0">
      <svg id="notificationIcon" class="w-5 h-5 text-blue-500" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
      </svg>
     </div>
     <div class="ml-3">
      <p id="notificationText" class="text-sm font-medium text-gray-900"></p>
     </div>
     <div class="ml-auto pl-3"><button onclick="hideNotification()" class="text-gray-400 hover:text-gray-600">
       <svg class="w-4 h-4" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
       </svg></button>
     </div>
    </div>
   </div>
  </div>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Home Section -->
   <div id="homeSection" class="section">
    <div class="text-center mb-12">
     <h1 class="text-4xl md:text-6xl font-bold text-primary mb-6">BionicText AI</h1>
     <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-8" data-translate="home_subtitle">Enhance your reading speed and comprehension with AI-powered text formatting. Experience the future of efficient reading.</p>
     <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="showSection('test')" class="bg-primary text-white px-8 py-4 rounded-lg font-medium hover:bg-blue-800 transition-colors" data-translate="home_start_test">Start Reading Test</button> <button onclick="showSection('converter')" class="border-2 border-primary text-primary px-8 py-4 rounded-lg font-medium hover:bg-primary hover:text-white transition-colors" data-translate="home_try_converter">Try Converter</button>
     </div>
    </div>
    <div class="grid md:grid-cols-3 gap-8 mt-16">
     <div class="bg-white p-8 rounded-xl shadow-lg text-center">
      <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
       </svg>
      </div>
      <h3 class="text-xl font-semibold text-primary mb-3" data-translate="home_speed_reading">Speed Reading</h3>
      <p class="text-gray-600" data-translate="home_speed_desc">Increase your reading speed by up to 200% with our scientifically-backed BionicText format.</p>
     </div>
     <div class="bg-white p-8 rounded-xl shadow-lg text-center">
      <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg>
      </div>
      <h3 class="text-xl font-semibold text-primary mb-3" data-translate="home_comprehension">Better Comprehension</h3>
      <p class="text-gray-600" data-translate="home_comprehension_desc">Maintain or improve understanding while reading faster through enhanced text formatting.</p>
     </div>
     <div class="bg-white p-8 rounded-xl shadow-lg text-center">
      <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
       </svg>
      </div>
      <h3 class="text-xl font-semibold text-primary mb-3" data-translate="home_ai_powered">AI-Powered</h3>
      <p class="text-gray-600" data-translate="home_ai_desc">Advanced algorithms analyze text patterns to optimize formatting for maximum reading efficiency.</p>
     </div>
    </div>
   </div><!-- Reading Speed Test Section -->
   <div id="testSection" class="section hidden">
    <div class="max-w-4xl mx-auto">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-primary mb-4" data-translate="test_title">Reading Speed Test</h2>
      <p class="text-gray-600" data-translate="test_subtitle">Compare your reading speed with normal text vs. BionicText format</p>
     </div><!-- Test Step 1: Normal Text -->
     <div id="testStep1" class="bg-white rounded-xl shadow-lg p-8 mb-6">
      <div class="flex items-center justify-between mb-6">
       <h3 class="text-xl font-semibold text-primary" data-translate="test_step1">Step 1: Normal Text Reading</h3>
       <div class="text-sm text-gray-500"><span id="timer1">00:00</span>
       </div>
      </div><!-- Text Selection Options -->
      <div class="mb-4">
       <div class="flex flex-wrap gap-2 mb-4"><button onclick="setTestTextMode('preset')" class="test-text-btn bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium" data-translate="test_preset_text">Preset Text</button> <button onclick="setTestTextMode('custom')" class="test-text-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-300" data-translate="test_custom_text">Custom Text</button>
       </div>
      </div><!-- Preset Text Mode -->
      <div id="presetTextMode" class="test-text-mode">
       <div class="mb-4"><select id="presetTextSelect" onchange="loadPresetText()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"> <option value="ai" data-translate="test_preset_ai">AI Technology</option> <option value="science" data-translate="test_preset_science">Science &amp; Nature</option> <option value="history" data-translate="test_preset_history">History</option> <option value="literature" data-translate="test_preset_literature">Literature</option> </select>
       </div>
       <div id="presetTextContent" class="bg-gray-50 p-6 rounded-lg mb-6 text-lg leading-relaxed">
        <p id="testText1">The rapid advancement of artificial intelligence has transformed numerous industries and aspects of daily life. From healthcare diagnostics to autonomous vehicles, AI systems are becoming increasingly sophisticated and capable. Machine learning algorithms can now process vast amounts of data to identify patterns and make predictions with remarkable accuracy. Natural language processing has enabled computers to understand and generate human-like text, revolutionizing communication and content creation. As we continue to develop these technologies, it becomes crucial to consider their ethical implications and ensure they benefit society as a whole. The future of AI holds immense potential for solving complex global challenges, but it also requires careful consideration of privacy, security, and the impact on employment markets.</p>
       </div>
      </div><!-- Custom Text Mode -->
      <div id="customTextMode" class="test-text-mode hidden">
       <div class="mb-4"><textarea id="customTestText" class="w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" data-translate-placeholder="test_custom_placeholder" placeholder="Enter your own text here for the reading test..."></textarea>
        <div class="flex justify-between items-center mt-2 text-sm text-gray-500"><span data-translate="test_word_count">Word count: <span id="customWordCount">0</span></span> <span data-translate="test_recommended">Recommended: 100-200 words</span>
        </div>
       </div>
       <div id="customTextDisplay" class="bg-gray-50 p-6 rounded-lg mb-6 text-lg leading-relaxed hidden">
        <p id="customDisplayText"></p>
       </div><button onclick="loadCustomText()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors mb-4" data-translate="test_load_custom">Load Custom Text</button>
      </div>
      <div class="flex gap-4"><button id="startBtn1" onclick="startTimer(1)" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors" data-translate="test_start_timer">Start Timer</button> <button id="finishBtn1" onclick="finishTimer(1)" class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:bg-gray-400" disabled data-translate="test_finish_timer">Finish Timer</button>
      </div>
     </div><!-- Test Step 2: BionicText -->
     <div id="testStep2" class="bg-white rounded-xl shadow-lg p-8 mb-6 hidden">
      <div class="flex items-center justify-between mb-6">
       <h3 class="text-xl font-semibold text-primary" data-translate="test_step2">Step 2: BionicText Reading</h3>
       <div class="text-sm text-gray-500"><span id="timer2">00:00</span>
       </div>
      </div>
      <div class="bg-gray-50 p-6 rounded-lg mb-6 text-lg leading-relaxed">
       <p id="testText2"><span class="bionic-bold">Th</span>e <span class="bionic-bold">rap</span>id <span class="bionic-bold">adv</span>ancement of <span class="bionic-bold">art</span>ificial <span class="bionic-bold">int</span>elligence has <span class="bionic-bold">tra</span>nsformed <span class="bionic-bold">num</span>erous <span class="bionic-bold">ind</span>ustries and <span class="bionic-bold">asp</span>ects of <span class="bionic-bold">dai</span>ly life. <span class="bionic-bold">Fr</span>om <span class="bionic-bold">hea</span>lthcare <span class="bionic-bold">dia</span>gnostics to <span class="bionic-bold">aut</span>onomous <span class="bionic-bold">veh</span>icles, AI <span class="bionic-bold">sys</span>tems are <span class="bionic-bold">bec</span>oming <span class="bionic-bold">inc</span>reasingly <span class="bionic-bold">sop</span>histicated and <span class="bionic-bold">cap</span>able. <span class="bionic-bold">Mac</span>hine <span class="bionic-bold">lea</span>rning <span class="bionic-bold">alg</span>orithms can now <span class="bionic-bold">pro</span>cess vast <span class="bionic-bold">amo</span>unts of data to <span class="bionic-bold">ide</span>ntify <span class="bionic-bold">pat</span>terns and make <span class="bionic-bold">pre</span>dictions <span class="bionic-bold">wi</span>th <span class="bionic-bold">rem</span>arkable <span class="bionic-bold">acc</span>uracy.</p>
      </div>
      <div class="flex gap-4"><button id="startBtn2" onclick="startTimer(2)" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors" data-translate="test_start_timer">Start Timer</button> <button id="finishBtn2" onclick="finishTimer(2)" class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors disabled:bg-gray-400" disabled data-translate="test_finish_timer">Finish Timer</button>
      </div>
     </div><!-- Test Results -->
     <div id="testResults" class="bg-white rounded-xl shadow-lg p-8 hidden">
      <h3 class="text-2xl font-semibold text-primary mb-6 text-center" data-translate="test_results_title">Your Reading Speed Results</h3>
      <div class="grid md:grid-cols-2 gap-8 mb-8">
       <div class="text-center">
        <h4 class="text-lg font-medium text-gray-700 mb-2" data-translate="test_normal_text">Normal Text</h4>
        <div class="text-3xl font-bold text-primary mb-2" id="normalWPM">
         0
        </div>
        <div class="text-sm text-gray-500" data-translate="test_wpm">
         words per minute
        </div>
       </div>
       <div class="text-center">
        <h4 class="text-lg font-medium text-gray-700 mb-2" data-translate="test_bionic_text">BionicText</h4>
        <div class="text-3xl font-bold text-primary mb-2" id="bionicWPM">
         0
        </div>
        <div class="text-sm text-gray-500" data-translate="test_wpm">
         words per minute
        </div>
       </div>
      </div>
      <div class="bg-gray-50 p-6 rounded-lg mb-6">
       <div class="flex justify-between items-center mb-2"><span class="text-sm font-medium text-gray-700" data-translate="test_improvement">Speed Improvement</span> <span class="text-sm font-bold text-primary" id="improvement">+0%</span>
       </div>
       <div class="w-full bg-gray-200 rounded-full h-3">
        <div class="bg-primary h-3 rounded-full progress-bar" id="progressBar" style="width: 0%"></div>
       </div>
      </div>
      <div class="flex gap-4 justify-center"><button onclick="downloadResults()" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors" data-translate="test_download_report">Download PDF Report</button> <button onclick="resetTest()" class="border-2 border-primary text-primary px-6 py-3 rounded-lg font-medium hover:bg-primary hover:text-white transition-colors" data-translate="test_take_again">Take Test Again</button>
      </div>
     </div>
    </div>
   </div><!-- Converter Section -->
   <div id="converterSection" class="section hidden">
    <div class="max-w-6xl mx-auto">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-primary mb-4" data-translate="converter_title">BionicText Converter</h2>
      <p class="text-gray-600" data-translate="converter_subtitle">Transform any text into BionicText format for enhanced reading speed</p>
     </div>
     <div class="grid lg:grid-cols-2 gap-8"><!-- Input Section -->
      <div class="bg-white rounded-xl shadow-lg p-6">
       <h3 class="text-xl font-semibold text-primary mb-4" data-translate="converter_input_text">Input Text</h3>
       <div class="mb-4">
        <div class="flex flex-wrap gap-2 mb-4"><button onclick="setInputMode('text')" class="input-mode-btn bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium" data-translate="converter_text_input">Text Input</button> <button onclick="setInputMode('file')" class="input-mode-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-300" data-translate="converter_file_upload">File Upload</button> <button onclick="setInputMode('voice')" class="input-mode-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-300" data-translate="converter_voice_input">Voice Input</button>
        </div>
       </div><!-- Text Input Mode -->
       <div id="textInputMode" class="input-mode"><textarea id="inputText" class="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none resize-none" data-translate-placeholder="converter_paste_text" placeholder="Paste your text here or start typing..."></textarea>
       </div><!-- File Upload Mode -->
       <div id="fileInputMode" class="input-mode hidden">
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors">
         <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
         </svg>
         <p class="text-gray-600 mb-2" data-translate="converter_drop_file">Drop your PDF or TXT file here</p>
         <p class="text-sm text-gray-500 mb-4" data-translate="converter_click_browse">or click to browse</p><input type="file" id="fileInput" accept=".pdf,.txt" class="hidden" onchange="handleFileUpload(event)"> <button onclick="document.getElementById('fileInput').click()" class="bg-primary text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-800 transition-colors" data-translate="converter_choose_file">Choose File</button>
        </div>
       </div><!-- Voice Input Mode -->
       <div id="voiceInputMode" class="input-mode hidden">
        <div class="text-center p-8">
         <div class="w-24 h-24 bg-primary rounded-full flex items-center justify-center mx-auto mb-4 cursor-pointer hover:bg-blue-800 transition-colors" onclick="toggleVoiceRecording()">
          <svg id="micIcon" class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
          </svg>
         </div>
         <p class="text-gray-600 mb-2" data-translate="converter_click_record">Click to start recording</p>
         <p class="text-sm text-gray-500" data-translate="converter_speak_clearly">Speak clearly for best results</p>
         <div id="recordingStatus" class="mt-4 text-sm text-primary hidden" data-translate="converter_recording">
          Recording... Click to stop
         </div>
        </div>
       </div><button onclick="convertText()" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors mt-4" data-translate="converter_convert">Convert to BionicText</button>
      </div><!-- Output Section -->
      <div class="bg-white rounded-xl shadow-lg p-6">
       <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-primary" data-translate="converter_output">BionicText Output</h3>
        <div class="flex gap-2"><select id="fontSize" onchange="updateFontSize()" class="px-3 py-1 border border-gray-300 rounded text-sm"> <option value="16">16px</option> <option value="18" selected>18px</option> <option value="20">20px</option> <option value="24">24px</option> </select> <select id="fontFamily" onchange="updateFontFamily()" class="px-3 py-1 border border-gray-300 rounded text-sm"> <option value="Inter">Inter</option> <option value="Arial">Arial</option> <option value="Georgia">Georgia</option> <option value="Times New Roman">Times</option> </select>
        </div>
       </div>
       <div id="bionicOutput" class="h-64 p-4 border border-gray-300 rounded-lg overflow-y-auto bg-gray-50" style="font-size: 18px;">
        <p class="text-gray-500 italic" data-translate="converter_output_placeholder">Your converted BionicText will appear here...</p>
       </div>
       <div class="flex gap-2 mt-4"><button onclick="exportToPDF()" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-800 transition-colors text-sm" data-translate="converter_export_pdf">Export PDF</button> <button onclick="exportToTXT()" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-gray-700 transition-colors text-sm" data-translate="converter_export_txt">Export TXT</button> <button onclick="speakText()" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm" data-translate="converter_speak">ðŸ”Š Speak</button>
       </div><!-- TTS Options -->
       <div class="mt-4 p-4 bg-gray-50 rounded-lg">
        <h4 class="text-sm font-medium text-gray-700 mb-2" data-translate="converter_tts_options">Text-to-Speech Options</h4>
        <div class="flex gap-2"><select id="voiceLanguage" class="flex-1 px-3 py-2 border border-gray-300 rounded text-sm"> <option value="en-US">English (US)</option> <option value="tr-TR" selected>Turkish</option> <option value="es-ES">Spanish</option> <option value="it-IT">Italian</option> <option value="fr-FR">French</option> </select> <select id="voiceSpeed" class="px-3 py-2 border border-gray-300 rounded text-sm"> <option value="0.8">Slow</option> <option value="1" selected>Normal</option> <option value="1.2">Fast</option> </select>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- AI Assistant Section -->
   <div id="assistantSection" class="section hidden">
    <div class="max-w-4xl mx-auto">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-primary mb-4" data-translate="assistant_title">AI Assistant</h2>
      <p class="text-gray-600" data-translate="assistant_subtitle">Ask me anything about BionicText, reading techniques, or your personal reading data!</p>
     </div><!-- Chat Container -->
     <div class="bg-white rounded-xl shadow-lg overflow-hidden"><!-- Chat Header -->
      <div class="bg-primary text-white p-4 flex items-center justify-between">
       <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
         </svg>
        </div>
        <div>
         <h3 class="font-semibold" data-translate="assistant_name">BionicText AI Assistant</h3>
         <p class="text-sm opacity-90" data-translate="assistant_status">Online â€¢ Ready to help</p>
        </div>
       </div><button onclick="clearChat()" class="text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition-colors" title="Clear chat">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"></path>
        </svg></button>
      </div><!-- Chat Messages -->
      <div id="chatMessages" class="h-96 overflow-y-auto p-4 space-y-4 bg-gray-50"><!-- Welcome Message -->
       <div class="flex items-start space-x-3">
        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
         <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
         </svg>
        </div>
        <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
         <p class="text-gray-800" data-translate="assistant_welcome">Hello! I'm your BionicText AI Assistant. I can help you with:</p>
         <ul class="mt-2 text-sm text-gray-600 space-y-1">
          <li data-translate="assistant_help_1">â€¢ Questions about BionicText and speed reading</li>
          <li data-translate="assistant_help_2">â€¢ Analysis of your reading performance</li>
          <li data-translate="assistant_help_3">â€¢ Tips to improve your reading speed</li>
          <li data-translate="assistant_help_4">â€¢ General questions about anything!</li>
         </ul>
         <p class="mt-2 text-sm text-gray-500" data-translate="assistant_ask">What would you like to know?</p>
        </div>
       </div>
      </div><!-- Quick Suggestions -->
      <div class="p-4 border-t bg-white">
       <div class="flex flex-wrap gap-2 mb-4"><button onclick="sendQuickMessage('What is BionicText and how does it work?')" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors" data-translate="quick_what_bionic">What is BionicText?</button> <button onclick="sendQuickMessage('How can I improve my reading speed?')" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors" data-translate="quick_improve_speed">Improve reading speed</button> <button onclick="sendQuickMessage('Show me my reading statistics')" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors" data-translate="quick_my_stats">My statistics</button> <button onclick="sendQuickMessage('What are the benefits of speed reading?')" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-full text-sm transition-colors" data-translate="quick_benefits">Speed reading benefits</button>
       </div><!-- Chat Input -->
       <div class="flex space-x-3"><input type="text" id="chatInput" placeholder="Type your message..." class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" data-translate-placeholder="assistant_input_placeholder" onkeypress="handleChatKeyPress(event)"> <button onclick="sendMessage()" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors flex items-center space-x-2" id="sendButton"> <span data-translate="assistant_send">Send</span>
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
         </svg></button>
       </div>
      </div>
     </div><!-- AI Features Info -->
     <div class="mt-8 grid md:grid-cols-3 gap-6">
      <div class="bg-white p-6 rounded-xl shadow-lg text-center">
       <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
       <h3 class="font-semibold text-gray-800 mb-2" data-translate="assistant_feature_1">Smart Analysis</h3>
       <p class="text-sm text-gray-600" data-translate="assistant_feature_1_desc">Get insights about your reading patterns and performance trends</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg text-center">
       <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
       </div>
       <h3 class="font-semibold text-gray-800 mb-2" data-translate="assistant_feature_2">Personalized Tips</h3>
       <p class="text-sm text-gray-600" data-translate="assistant_feature_2_desc">Receive customized advice based on your reading data and goals</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg text-center">
       <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
       </div>
       <h3 class="font-semibold text-gray-800 mb-2" data-translate="assistant_feature_3">24/7 Support</h3>
       <p class="text-sm text-gray-600" data-translate="assistant_feature_3_desc">Ask questions anytime about reading techniques and BionicText</p>
      </div>
     </div>
    </div>
   </div><!-- Settings Section -->
   <div id="settingsSection" class="section hidden">
    <div class="max-w-4xl mx-auto">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-primary mb-4" data-translate="settings_title">Ayarlar</h2>
      <p class="text-gray-600" data-translate="settings_subtitle">Okuma deneyiminizi kiÅŸiselleÅŸtirin</p>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
      <h3 class="text-xl font-semibold text-primary mb-6" data-translate="settings_appearance">GÃ¶rÃ¼nÃ¼m AyarlarÄ±</h3><!-- Font Size -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3" data-translate="settings_font_size">YazÄ± Boyutu</label>
       <div class="flex items-center space-x-4"><input type="range" id="globalFontSize" min="14" max="24" value="18" class="flex-1" oninput="updateGlobalFontSize(this.value)"> <span id="fontSizeValue" class="text-sm font-medium text-gray-600 w-12 text-center">18px</span>
       </div>
       <div class="mt-3 p-4 bg-gray-50 rounded-lg">
        <p id="previewText" class="text-gray-800" style="font-size: 18px;">Bu bir Ã¶nizleme metnidir. YazÄ± boyutunu ayarlayÄ±n.</p>
       </div>
      </div><!-- Line Height -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3" data-translate="settings_line_height">SatÄ±r YÃ¼ksekliÄŸi</label>
       <div class="flex items-center space-x-4"><input type="range" id="globalLineHeight" min="1.2" max="2.0" step="0.1" value="1.6" class="flex-1" oninput="updateGlobalLineHeight(this.value)"> <span id="lineHeightValue" class="text-sm font-medium text-gray-600 w-12 text-center">1.6</span>
       </div>
      </div><!-- Bold Intensity -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3" data-translate="settings_bold_intensity">KalÄ±n Metin YoÄŸunluÄŸu (BionicText)</label>
       <div class="flex items-center space-x-4"><input type="range" id="boldIntensity" min="30" max="70" value="50" class="flex-1" oninput="updateBoldIntensity(this.value)"> <span id="boldIntensityValue" class="text-sm font-medium text-gray-600 w-12 text-center">50%</span>
       </div>
       <div class="mt-3 p-4 bg-gray-50 rounded-lg">
        <p id="bionicPreview" class="text-gray-800"></p>
       </div>
      </div><!-- Theme -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3" data-translate="settings_theme">Tema</label>
       <div class="grid grid-cols-3 gap-4"><button onclick="setTheme('light')" class="theme-btn border-2 border-primary bg-white p-4 rounded-lg text-center hover:bg-gray-50 transition-colors">
         <div class="w-12 h-12 bg-white border-2 border-gray-300 rounded-lg mx-auto mb-2"></div><span class="text-sm font-medium" data-translate="settings_light">AÃ§Ä±k</span> </button> <button onclick="setTheme('dark')" class="theme-btn border-2 border-gray-300 p-4 rounded-lg text-center hover:bg-gray-50 transition-colors">
         <div class="w-12 h-12 bg-gray-800 border-2 border-gray-600 rounded-lg mx-auto mb-2"></div><span class="text-sm font-medium" data-translate="settings_dark">Koyu</span> </button> <button onclick="setTheme('sepia')" class="theme-btn border-2 border-gray-300 p-4 rounded-lg text-center hover:bg-gray-50 transition-colors">
         <div class="w-12 h-12 bg-yellow-50 border-2 border-yellow-200 rounded-lg mx-auto mb-2"></div><span class="text-sm font-medium" data-translate="settings_sepia">Sepya</span> </button>
       </div>
      </div><!-- Reset Button -->
      <div class="pt-4 border-t border-gray-200"><button onclick="resetSettings()" class="w-full bg-gray-600 text-white py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors" data-translate="settings_reset">AyarlarÄ± SÄ±fÄ±rla</button>
      </div>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-8">
      <h3 class="text-xl font-semibold text-primary mb-6" data-translate="settings_reading">Okuma AyarlarÄ±</h3><!-- Reading Guide -->
      <div class="mb-6">
       <div class="flex items-center justify-between mb-2"><label class="text-sm font-medium text-gray-700" data-translate="settings_reading_guide">Okuma KÄ±lavuzu</label> <label class="relative inline-flex items-center cursor-pointer"> <input type="checkbox" id="readingGuide" class="sr-only peer" onchange="toggleReadingGuide()">
         <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div></label>
       </div>
       <p class="text-sm text-gray-500" data-translate="settings_guide_desc">SatÄ±r vurgulama ile okuma odaÄŸÄ±nÄ± artÄ±rÄ±n</p>
      </div><!-- Auto-scroll -->
      <div class="mb-6">
       <div class="flex items-center justify-between mb-2"><label class="text-sm font-medium text-gray-700" data-translate="settings_auto_scroll">Otomatik KaydÄ±rma</label> <label class="relative inline-flex items-center cursor-pointer"> <input type="checkbox" id="autoScroll" class="sr-only peer" onchange="toggleAutoScroll()">
         <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div></label>
       </div>
       <p class="text-sm text-gray-500" data-translate="settings_scroll_desc">Okurken otomatik sayfa kaydÄ±rma</p>
      </div>
     </div>
    </div>
   </div><!-- Profile Section -->
   <div id="profileSection" class="section hidden">
    <div class="max-w-6xl mx-auto"><!-- Profile Header -->
     <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
      <div class="flex items-center justify-between">
       <div class="flex items-center space-x-4">
        <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center"><span class="text-white text-xl font-bold" id="userInitials">U</span>
        </div>
        <div>
         <h2 class="text-2xl font-bold text-primary" id="profileUserName" data-translate="profile_title">User Profile</h2>
         <p class="text-gray-600" id="profileUserEmail">user@example.com</p>
         <p class="text-sm text-gray-500"><span data-translate="profile_member_since">Member since</span> <span id="memberSince">Today</span></p>
        </div>
       </div>
       <div class="text-right">
        <div class="text-3xl font-bold text-primary" id="totalTests">
         0
        </div>
        <div class="text-sm text-gray-500" data-translate="profile_total_tests">
         Total Tests
        </div>
       </div>
      </div>
     </div>
     <div class="grid lg:grid-cols-3 gap-8"><!-- Reading Statistics -->
      <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
       <h3 class="text-xl font-semibold text-primary mb-6">Reading Statistics</h3>
       <div class="grid md:grid-cols-2 gap-4 mb-6">
        <div class="bg-blue-50 p-4 rounded-lg text-center">
         <div class="text-2xl font-bold text-primary" id="avgNormalSpeed">
          0
         </div>
         <div class="text-sm text-gray-600">
          Avg Normal Speed (WPM)
         </div>
        </div>
        <div class="bg-green-50 p-4 rounded-lg text-center">
         <div class="text-2xl font-bold text-green-600" id="avgBionicSpeed">
          0
         </div>
         <div class="text-sm text-gray-600">
          Avg BionicText Speed (WPM)
         </div>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg text-center">
         <div class="text-2xl font-bold text-purple-600" id="avgImprovement">
          0%
         </div>
         <div class="text-sm text-gray-600">
          Average Improvement
         </div>
        </div>
        <div class="bg-yellow-50 p-4 rounded-lg text-center">
         <div class="text-2xl font-bold text-yellow-600" id="bestImprovement">
          0%
         </div>
         <div class="text-sm text-gray-600">
          Best Improvement
         </div>
        </div>
       </div><!-- Progress Chart -->
       <div class="mb-6">
        <h4 class="text-lg font-medium text-gray-700 mb-3">Reading Speed Progress</h4>
        <div class="bg-gray-50 p-4 rounded-lg">
         <canvas id="progressChart" width="400" height="200" class="w-full"></canvas>
        </div>
       </div><!-- Recent Test History -->
       <div>
        <h4 class="text-lg font-medium text-gray-700 mb-3">Recent Test Results</h4>
        <div class="space-y-2" id="recentTests">
         <div class="text-center text-gray-500 py-8">
          <p>No test results yet. Take your first reading speed test!</p><button onclick="navigateToSection('test')" class="mt-2 text-primary hover:text-blue-800 font-medium">Start Test</button>
         </div>
        </div>
       </div>
      </div><!-- Achievements & Goals -->
      <div class="space-y-6"><!-- Achievements -->
       <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-xl font-semibold text-primary mb-4">Achievements</h3>
        <div class="space-y-3" id="achievements">
         <div class="flex items-center p-3 bg-gray-50 rounded-lg opacity-50">
          <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3"><span class="text-sm">ðŸ†</span>
          </div>
          <div>
           <div class="font-medium text-gray-700">
            First Test
           </div>
           <div class="text-xs text-gray-500">
            Complete your first reading test
           </div>
          </div>
         </div>
         <div class="flex items-center p-3 bg-gray-50 rounded-lg opacity-50">
          <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3"><span class="text-sm">âš¡</span>
          </div>
          <div>
           <div class="font-medium text-gray-700">
            Speed Demon
           </div>
           <div class="text-xs text-gray-500">
            Reach 300+ WPM with BionicText
           </div>
          </div>
         </div>
         <div class="flex items-center p-3 bg-gray-50 rounded-lg opacity-50">
          <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3"><span class="text-sm">ðŸ“ˆ</span>
          </div>
          <div>
           <div class="font-medium text-gray-700">
            Consistent Reader
           </div>
           <div class="text-xs text-gray-500">
            Complete 10 tests
           </div>
          </div>
         </div>
        </div>
       </div><!-- Quick Actions -->
       <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-xl font-semibold text-primary mb-4">Quick Actions</h3>
        <div class="space-y-3"><button onclick="showSection('test')" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-blue-800 transition-colors"> Take New Test </button> <button onclick="showSection('converter')" class="w-full border-2 border-primary text-primary py-3 rounded-lg font-medium hover:bg-primary hover:text-white transition-colors"> Convert Text </button> <button onclick="exportAllData()" class="w-full bg-gray-600 text-white py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors"> Export All Data </button> <button onclick="deleteAllData()" class="w-full bg-red-600 text-white py-3 rounded-lg font-medium hover:bg-red-700 transition-colors"> Delete All Data </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </main>
  <script>
        // Global variables
        let currentSection = 'home';
        let testTimers = { 1: null, 2: null };
        let testStartTimes = { 1: null, 2: null };
        let testResults = { normal: 0, bionic: 0 };
        let isRecording = false;
        let recognition = null;
        let currentLanguage = 'tr';
        let chatHistory = [];
        let userTestData = [];
        let currentTestText = '';
        let currentWordCount = 0;

        // Translation data
        const translations = {
            en: {
                // Navigation
                nav_home: "Home",
                nav_test: "Test",
                nav_converter: "Converter",
                nav_assistant: "AI Assistant",
                nav_profile: "Profile",
                nav_settings: "Settings",
                login: "Login",
                logout: "Logout",
                
                // Settings
                settings_title: "Settings",
                settings_subtitle: "Customize your reading experience",
                settings_appearance: "Appearance Settings",
                settings_font_size: "Font Size",
                settings_line_height: "Line Height",
                settings_bold_intensity: "Bold Text Intensity (BionicText)",
                settings_theme: "Theme",
                settings_light: "Light",
                settings_dark: "Dark",
                settings_sepia: "Sepia",
                settings_reset: "Reset Settings",
                settings_reading: "Reading Settings",
                settings_reading_guide: "Reading Guide",
                settings_guide_desc: "Increase reading focus with line highlighting",
                settings_auto_scroll: "Auto-scroll",
                settings_scroll_desc: "Automatic page scrolling while reading",
                
                // Authentication
                auth_welcome: "Welcome Back",
                auth_signin_subtitle: "Sign in to your account",
                auth_email: "Email",
                auth_password: "Password",
                auth_email_placeholder: "Enter your email",
                auth_password_placeholder: "Enter your password",
                auth_signin: "Sign In",
                auth_signup: "Sign up",
                auth_no_account: "Don't have an account? ",
                auth_create_account: "Create Account",
                auth_signup_subtitle: "Sign up for a new account",
                auth_have_account: "Already have an account? ",
                
                // Home page
                home_subtitle: "Enhance your reading speed and comprehension with AI-powered text formatting. Experience the future of efficient reading.",
                home_start_test: "Start Reading Test",
                home_try_converter: "Try Converter",
                home_speed_reading: "Speed Reading",
                home_speed_desc: "Increase your reading speed by up to 200% with our scientifically-backed BionicText format.",
                home_comprehension: "Better Comprehension",
                home_comprehension_desc: "Maintain or improve understanding while reading faster through enhanced text formatting.",
                home_ai_powered: "AI-Powered",
                home_ai_desc: "Advanced algorithms analyze text patterns to optimize formatting for maximum reading efficiency.",
                
                // Test section
                test_title: "Reading Speed Test",
                test_subtitle: "Compare your reading speed with normal text vs. BionicText format",
                test_step1: "Step 1: Normal Text Reading",
                test_step2: "Step 2: BionicText Reading",
                test_start_timer: "Start Timer",
                test_finish_timer: "Finish Timer",
                test_results_title: "Your Reading Speed Results",
                test_normal_text: "Normal Text",
                test_bionic_text: "BionicText",
                test_wpm: "words per minute",
                test_improvement: "Speed Improvement",
                test_download_report: "Download PDF Report",
                test_take_again: "Take Test Again",
                test_preset_text: "Preset Text",
                test_custom_text: "Custom Text",
                test_preset_ai: "AI Technology",
                test_preset_science: "Science & Nature",
                test_preset_history: "History",
                test_preset_literature: "Literature",
                test_custom_placeholder: "Enter your own text here for the reading test...",
                test_word_count: "Word count:",
                test_recommended: "Recommended: 100-200 words",
                test_load_custom: "Load Custom Text",
                
                // Converter section
                converter_title: "BionicText Converter",
                converter_subtitle: "Transform any text into BionicText format for enhanced reading speed",
                converter_input_text: "Input Text",
                converter_text_input: "Text Input",
                converter_file_upload: "File Upload",
                converter_voice_input: "Voice Input",
                converter_paste_text: "Paste your text here or start typing...",
                converter_drop_file: "Drop your PDF or TXT file here",
                converter_click_browse: "or click to browse",
                converter_choose_file: "Choose File",
                converter_click_record: "Click to start recording",
                converter_speak_clearly: "Speak clearly for best results",
                converter_recording: "Recording... Click to stop",
                converter_convert: "Convert to BionicText",
                converter_output: "BionicText Output",
                converter_output_placeholder: "Your converted BionicText will appear here...",
                converter_export_pdf: "Export PDF",
                converter_export_txt: "Export TXT",
                converter_speak: "ðŸ”Š Speak",
                converter_tts_options: "Text-to-Speech Options",
                
                // Profile section
                profile_title: "User Profile",
                profile_member_since: "Member since",
                profile_total_tests: "Total Tests",
                
                // Profile menu
                profile_menu_profile: "My Profile",
                profile_menu_test: "Take Reading Test",
                profile_menu_converter: "Convert Text",
                profile_menu_assistant: "AI Assistant",
                profile_menu_export: "Export Data",
                profile_menu_logout: "Sign Out",
                
                // Notifications
                notif_login_success: "Welcome back! Successfully logged in.",
                notif_login_failed: "Login failed: ",
                notif_test_saved: "Test results saved to your profile!",
                notif_signin_to_save: "Sign in to save your test results!",
                notif_data_exported: "Successfully exported test results!",
                notif_data_deleted: "All data deleted successfully",
                notif_no_data_export: "No test data to export. Take some tests first!",
                
                // AI Assistant
                assistant_title: "AI Assistant",
                assistant_subtitle: "Ask me anything about BionicText, reading techniques, or your personal reading data!",
                assistant_name: "BionicText AI Assistant",
                assistant_status: "Online â€¢ Ready to help",
                assistant_welcome: "Hello! I'm your BionicText AI Assistant. I can help you with:",
                assistant_help_1: "â€¢ Questions about BionicText and speed reading",
                assistant_help_2: "â€¢ Analysis of your reading performance",
                assistant_help_3: "â€¢ Tips to improve your reading speed",
                assistant_help_4: "â€¢ General questions about anything!",
                assistant_ask: "What would you like to know?",
                assistant_input_placeholder: "Type your message...",
                assistant_send: "Send",
                assistant_feature_1: "Smart Analysis",
                assistant_feature_1_desc: "Get insights about your reading patterns and performance trends",
                assistant_feature_2: "Personalized Tips",
                assistant_feature_2_desc: "Receive customized advice based on your reading data and goals",
                assistant_feature_3: "24/7 Support",
                assistant_feature_3_desc: "Ask questions anytime about reading techniques and BionicText",
                quick_what_bionic: "What is BionicText?",
                quick_improve_speed: "Improve reading speed",
                quick_my_stats: "My statistics",
                quick_benefits: "Speed reading benefits"
            },
            
            tr: {
                // Navigation
                nav_home: "Ana Sayfa",
                nav_test: "Test",
                nav_converter: "DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼",
                nav_assistant: "AI Asistan",
                nav_profile: "Profil",
                nav_settings: "Ayarlar",
                login: "GiriÅŸ Yap",
                logout: "Ã‡Ä±kÄ±ÅŸ Yap",
                
                // Settings
                settings_title: "Ayarlar",
                settings_subtitle: "Okuma deneyiminizi kiÅŸiselleÅŸtirin",
                settings_appearance: "GÃ¶rÃ¼nÃ¼m AyarlarÄ±",
                settings_font_size: "YazÄ± Boyutu",
                settings_line_height: "SatÄ±r YÃ¼ksekliÄŸi",
                settings_bold_intensity: "KalÄ±n Metin YoÄŸunluÄŸu (BionicText)",
                settings_theme: "Tema",
                settings_light: "AÃ§Ä±k",
                settings_dark: "Koyu",
                settings_sepia: "Sepya",
                settings_reset: "AyarlarÄ± SÄ±fÄ±rla",
                settings_reading: "Okuma AyarlarÄ±",
                settings_reading_guide: "Okuma KÄ±lavuzu",
                settings_guide_desc: "SatÄ±r vurgulama ile okuma odaÄŸÄ±nÄ± artÄ±rÄ±n",
                settings_auto_scroll: "Otomatik KaydÄ±rma",
                settings_scroll_desc: "Okurken otomatik sayfa kaydÄ±rma",
                
                // Authentication
                auth_welcome: "Tekrar HoÅŸ Geldiniz",
                auth_signin_subtitle: "HesabÄ±nÄ±za giriÅŸ yapÄ±n",
                auth_email: "E-posta",
                auth_password: "Åžifre",
                auth_email_placeholder: "E-posta adresinizi girin",
                auth_password_placeholder: "Åžifrenizi girin",
                auth_signin: "GiriÅŸ Yap",
                auth_signup: "Kay  t Ol",
                auth_no_account: "HesabÄ±nÄ±z yok mu? ",
                auth_create_account: "Hesap OluÅŸtur",
                auth_signup_subtitle: "Yeni hesap oluÅŸturun",
                auth_have_account: "Zaten hesabÄ±nÄ±z var mÄ±? ",
                
                // Home page
                home_subtitle: "AI destekli metin biÃ§imlendirme ile okuma hÄ±zÄ±nÄ±zÄ± ve anlayÄ±ÅŸÄ±nÄ±zÄ± artÄ±rÄ±n. Verimli okumanÄ±n geleceÄŸini deneyimleyin.",
                home_start_test: "Okuma Testini BaÅŸlat",
                home_try_converter: "DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼yÃ¼ Dene",
                home_speed_reading: "HÄ±zlÄ± Okuma",
                home_speed_desc: "Bilimsel olarak desteklenen BionicText formatÄ± ile okuma hÄ±zÄ±nÄ±zÄ± %200'e kadar artÄ±rÄ±n.",
                home_comprehension: "Daha Ä°yi AnlayÄ±ÅŸ",
                home_comprehension_desc: "GeliÅŸmiÅŸ metin biÃ§imlendirme ile daha hÄ±zlÄ± okurken anlayÄ±ÅŸÄ±nÄ±zÄ± koruyun veya geliÅŸtirin.",
                home_ai_powered: "AI Destekli",
                home_ai_desc: "GeliÅŸmiÅŸ algoritmalar, maksimum okuma verimliliÄŸi iÃ§in metin kalÄ±plarÄ±nÄ± analiz eder ve biÃ§imlendirmeyi optimize eder.",
                
                // Test section
                test_title: "Okuma HÄ±zÄ± Testi",
                test_subtitle: "Normal metin ile BionicText formatÄ±ndaki okuma hÄ±zÄ±nÄ±zÄ± karÅŸÄ±laÅŸtÄ±rÄ±n",
                test_step1: "AdÄ±m 1: Normal Metin Okuma",
                test_step2: "AdÄ±m 2: BionicText Okuma",
                test_start_timer: "ZamanlayÄ±cÄ±yÄ± BaÅŸlat",
                test_finish_timer: "ZamanlayÄ±cÄ±yÄ± Bitir",
                test_results_title: "Okuma HÄ±zÄ± SonuÃ§larÄ±nÄ±z",
                test_normal_text: "Normal Metin",
                test_bionic_text: "BionicText",
                test_wpm: "dakikada kelime",
                test_improvement: "HÄ±z Ä°yileÅŸtirmesi",
                test_download_report: "PDF Rapor Ä°ndir",
                test_take_again: "Testi Tekrar Al",
                test_preset_text: "Haz  r Metin",
                test_custom_text: "Ã–zel Metin",
                test_preset_ai: "AI Teknolojisi",
                test_preset_science: "Bilim ve DoÄŸa",
                test_preset_history: "Tarih",
                test_preset_literature: "Edebiyat",
                test_custom_placeholder: "Okuma testi iÃ§in kendi metninizi buraya girin...",
                test_word_count: "Kelime sayÄ±sÄ±:",
                test_recommended: "Ã–nerilen: 100-200 kelime",
                test_load_custom: "Ã–zel Metni YÃ¼kle",
                
                // Converter section
                converter_title: "BionicText DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼",
                converter_subtitle: "GeliÅŸmiÅŸ okuma hÄ±zÄ± iÃ§in herhangi bir metni BionicText formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼n",
                converter_input_text: "GiriÅŸ Metni",
                converter_text_input: "Metin GiriÅŸi",
                converter_file_upload: "Dosya YÃ¼kleme",
                converter_voice_input: "Ses GiriÅŸi",
                converter_paste_text: "Metninizi buraya yapÄ±ÅŸtÄ±rÄ±n veya yazmaya baÅŸlayÄ±n...",
                converter_drop_file: "PDF veya TXT dosyanÄ±zÄ± buraya bÄ±rakÄ±n",
                converter_click_browse: "veya gÃ¶z atmak iÃ§in tÄ±klayÄ±n",
                converter_choose_file: "Dosya SeÃ§",
                converter_click_record: "KayÄ±t baÅŸlatmak iÃ§in tÄ±klayÄ±n",
                converter_speak_clearly: "En iyi sonuÃ§lar iÃ§in net konuÅŸun",
                converter_recording: "Kaydediliyor... Durdurmak iÃ§in tÄ±klayÄ±n",
                converter_convert: "BionicText'e DÃ¶nÃ¼ÅŸtÃ¼r",
                converter_output: "BionicText Ã‡Ä±ktÄ±sÄ±",
                converter_output_placeholder: "DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ BionicText'iniz burada gÃ¶rÃ¼necek...",
                converter_export_pdf: "PDF DÄ±ÅŸa Aktar",
                converter_export_txt: "TXT DÄ±ÅŸa Aktar",
                converter_speak: "ðŸ”Š Seslendir",
                converter_tts_options: "Metinden Sese SeÃ§enekleri",
                
                // Profile section
                profile_title: "KullanÄ±cÄ± Profili",
                profile_member_since: "Ãœyelik tarihi",
                profile_total_tests: "Toplam Test",
                
                // Profile menu
                profile_menu_profile: "Profilim",
                profile_menu_test: "Okuma Testi Yap",
                profile_menu_converter: "Metin DÃ¶nÃ¼ÅŸtÃ¼r",
                profile_menu_assistant: "AI Asistan",
                profile_menu_export: "Veri DÄ±ÅŸa Aktar",
                profile_menu_logout: "Ã‡Ä±kÄ±ÅŸ Yap",
                
                // Notifications
                notif_login_success: "Tekrar hoÅŸ geldiniz! BaÅŸarÄ±yla giriÅŸ yaptÄ±nÄ±z.",
                notif_login_failed: "GiriÅŸ baÅŸarÄ±sÄ±z: ",
                notif_test_saved: "Test sonuÃ§larÄ± profilinize kaydedildi!",
                notif_signin_to_save: "Test sonuÃ§larÄ±nÄ±zÄ± kaydetmek iÃ§in giriÅŸ yapÄ±n!",
                notif_data_exported: "Test sonuÃ§larÄ± baÅŸarÄ±yla dÄ±ÅŸa aktarÄ±ldÄ±!",
                notif_data_deleted: "TÃ¼m veriler baÅŸarÄ±yla silindi",
                notif_no_data_export: "DÄ±ÅŸa aktarÄ±lacak test verisi yok. Ã–nce bazÄ± testler yapÄ±n!",
                
                // AI Assistant
                assistant_title: "AI Asistan",
                assistant_subtitle: "BionicText, okuma teknikleri veya kiÅŸisel okuma verileriniz hakkÄ±nda her ÅŸeyi sorabilirsiniz!",
                assistant_name: "BionicText AI Asistan",
                assistant_status: "Ã‡evrimiÃ§i â€¢ YardÄ±ma hazÄ±r",
                assistant_welcome: "Merhaba! Ben BionicText AI AsistanÄ±nÄ±zÄ±m. Size ÅŸunlarda yardÄ±mcÄ± olabilirim:",
                assistant_help_1: "â€¢ BionicText ve hÄ±zlÄ± okuma hakkÄ±nda sorular",
                assistant_help_2: "â€¢ Okuma performansÄ±nÄ±zÄ±n analizi",
                assistant_help_3: "â€¢ Okuma hÄ±zÄ±nÄ±zÄ± artÄ±rma ipuÃ§larÄ±",
                assistant_help_4: "â€¢ Her konuda genel sorular!",
                assistant_ask: "Ne Ã¶ÄŸrenmek istersiniz?",
                assistant_input_placeholder: "MesajÄ±nÄ±zÄ± yazÄ±n...",
                assistant_send: "GÃ¶nder",
                assistant_feature_1: "AkÄ±llÄ± Analiz",
                assistant_feature_1_desc: "Okuma kalÄ±plarÄ±nÄ±z ve performans trendleriniz hakkÄ±nda iÃ§gÃ¶rÃ¼ler edinin",
                assistant_feature_2: "KiÅŸiselleÅŸtirilmiÅŸ Ä°puÃ§larÄ±",
                assistant_feature_2_desc: "Okuma verilerinize ve hedeflerinize gÃ¶re   zelleÅŸtirilmiÅŸ tavsiyeler alÄ±n",
                assistant_feature_3: "7/24 Destek",
                assistant_feature_3_desc: "Okuma teknikleri ve BionicText hakkÄ±nda istediÄŸiniz zaman soru sorun",
                quick_what_bionic: "BionicText nedir?",
                quick_improve_speed: "Okuma hÄ±zÄ±nÄ± artÄ±r",
                quick_my_stats: "Ä°statistiklerim",
                quick_benefits: "HÄ±zlÄ± okuma faydalarÄ±"
            },
            
            it: {
                // Navigation
                nav_home: "Home",
                nav_test: "Test",
                nav_converter: "Convertitore",
                nav_assistant: "Assistente AI",
                nav_profile: "Profilo",
                nav_settings: "Impostazioni",
                login: "Accedi",
                logout: "Esci",
                
                // Settings
                settings_title: "Impostazioni",
                settings_subtitle: "Personalizza la tua esperienza di lettura",
                settings_appearance: "Impostazioni Aspetto",
                settings_font_size: "Dimensione Carattere",
                settings_line_height: "Altezza Linea",
                settings_bold_intensity: "IntensitÃ  Testo Grassetto (BionicText)",
                settings_theme: "Tema",
                settings_light: "Chiaro",
                settings_dark: "Scuro",
                settings_sepia: "Seppia",
                settings_reset: "Ripristina Impostazioni",
                settings_reading: "Impostazioni Lettura",
                settings_reading_guide: "Guida alla Lettura",
                settings_guide_desc: "Aumenta la concentrazione con l'evidenziazione delle righe",
                settings_auto_scroll: "Scorrimento Automatico",
                settings_scroll_desc: "Scorrimento automatico della pagina durante la lettura",
                
                // Authentication
                auth_welcome: "Bentornato",
                auth_signin_subtitle: "Accedi al tuo account",
                auth_email: "Email",
                auth_password: "Password",
                auth_email_placeholder: "Inserisci la tua email",
                auth_password_placeholder: "Inserisci la tua password",
                auth_signin: "Accedi",
                auth_signup: "Registrati",
                auth_no_account: "Non hai un account? ",
                auth_create_account: "Crea Account",
                auth_signup_subtitle: "Registrati per un nuovo account",
                auth_have_account: "Hai giÃ  un account? ",
                
                // Home page
                home_subtitle: "Migliora la tua velocitÃ  di lettura e comprensione con la formattazione del testo basata su AI. Sperimenta il futuro della lettura efficiente.",
                home_start_test: "Inizia Test di Lettura",
                home_try_converter: "Prova Convertitore",
                home_speed_reading: "Lettura Veloce",
                home_speed_desc: "Aumenta la tua velocitÃ  di lettura fino al 200% con il nostro formato BionicText scientificamente supportato.",
                home_comprehension: "Migliore Comprensione",
                home_comprehension_desc: "Mantieni o migliora la comprensione mentre leggi piÃ¹ velocemente attraverso la formattazione del testo migliorata.",
                home_ai_powered: "Alimentato da AI",
                home_ai_desc: "Algoritmi avanzati analizzano i modelli di testo per ottimizzare la formattazione per la massima efficienza di lettura.",
                
                // Test section
                test_title: "Test di VelocitÃ  di Lettura",
                test_subtitle: "Confronta la tua velocitÃ  di lettura con testo normale vs. formato BionicText",
                test_step1: "Passo 1: Lettura Testo Normale",
                test_step2: "Passo 2: Lettura BionicText",
                test_start_timer: "Avvia Timer",
                test_finish_timer: "Termina Timer",
                test_results_title: "I Tuoi Risultati di VelocitÃ  di Lettura",
                test_normal_text: "Testo Normale",
                test_bionic_text: "BionicText",
                test_wpm: "parole al minuto",
                test_improvement: "Miglioramento VelocitÃ ",
                test_download_report: "Scarica Report PDF",
                test_take_again: "Rifai il Test",
                
                // Converter section
                converter_title: "Convertitore BionicText",
                converter_subtitle: "Trasforma qualsiasi testo in formato BionicText per una velocitÃ  di lettura migliorata",
                converter_input_text: "Testo di Input",
                converter_text_input: "Input Testo",
                converter_file_upload: "Caricamento File",
                converter_voice_input: "Input Vocale",
                converter_paste_text: "Incolla il tuo testo qui o inizia a digitare...",
                converter_drop_file: "Trascina il tuo file PDF o TXT qui",
                converter_click_browse: "o clicca per sfogliare",
                converter_choose_file: "Scegli File",
                converter_click_record: "Clicca per iniziare la registrazione",
                converter_speak_clearly: "Parla chiaramente per i migliori risultati",
                converter_recording: "Registrando... Clicca per fermare",
                converter_convert: "Converti in BionicText",
                converter_output: "Output BionicText",
                converter_output_placeholder: "Il tuo BionicText convertito apparirÃ  qui...",
                converter_export_pdf: "Esporta PDF",
                converter_export_txt: "Esporta TXT",
                converter_speak: "ðŸ”Š Parla",
                converter_tts_options: "Opzioni Text-to-Speech",
                
                // Profile section
                profile_title: "Profilo Utente",
                profile_member_since: "Membro dal",
                profile_total_tests: "Test Totali",
                
                // Profile menu
                profile_menu_profile: "Il Mio Profilo",
                profile_menu_test: "Fai Test di Lettura",
                profile_menu_converter: "Converti Testo",
                profile_menu_assistant: "Assistente AI",
                profile_menu_export: "Esporta Dati",
                profile_menu_logout: "Esci",
                
                // Notifications
                notif_login_success: "Bentornato! Accesso effettuato con successo.",
                notif_login_failed: "Accesso fallito: ",
                notif_test_saved: "Risultati del test salvati nel tuo profilo!",
                notif_signin_to_save: "Accedi per salvare i risultati del test!",
                notif_data_exported: "Risultati del test esportati con successo!",
                notif_data_deleted: "Tutti i dati eliminati con successo",
                notif_no_data_export: "Nessun dato test da esportare. Fai prima alcuni test!",
                
                // AI Assistant
                assistant_title: "Assistente AI",
                assistant_subtitle: "Chiedimi qualsiasi cosa su BionicText, tecniche di lettura o i tuoi dati di lettura personali!",
                assistant_name: "Assistente AI BionicText",
                assistant_status: "Online â€¢ Pronto ad aiutare",
                assistant_welcome: "Ciao! Sono il tuo Assistente AI BionicText. Posso aiutarti con:",
                assistant_help_1: "â€¢ Domande su BionicText e lettura veloce",
                assistant_help_2: "â€¢ Analisi delle tue prestazioni di lettura",
                assistant_help_3: "â€¢ Consigli per migliorare la velocitÃ  di lettura",
                assistant_help_4: "â€¢ Domande generali su qualsiasi argomento!",
                assistant_ask: "Cosa vorresti sapere?",
                assistant_input_placeholder: "Scrivi il tuo messaggio...",
                assistant_send: "Invia",
                assistant_feature_1: "Analisi Intelligente",
                assistant_feature_1_desc: "Ottieni informazioni sui tuoi modelli di lettura e tendenze delle prestazioni",
                assistant_feature_2: "Consigli Personalizzati",
                assistant_feature_2_desc: "Ricevi consigli personalizzati basati sui tuoi dati di lettura e obiettivi",
                assistant_feature_3: "Supporto 24/7",
                assistant_feature_3_desc: "Fai domande in qualsiasi momento su tecniche di lettura e BionicText",
                quick_what_bionic: "Cos'Ã¨ BionicText?",
                quick_improve_speed: "Migliora velocitÃ  lettura",
                quick_my_stats: "Le mie statistiche",
                quick_benefits: "Benefici lettura veloce"
            }
        };

        // Preset texts for different languages
        const presetTexts = {
            en: {
                ai: "The rapid advancement of artificial intelligence has transformed numerous industries and aspects of daily life. From healthcare diagnostics to autonomous vehicles, AI systems are becoming increasingly sophisticated and capable. Machine learning algorithms can now process vast amounts of data to identify patterns and make predictions with remarkable accuracy. Natural language processing has enabled computers to understand and generate human-like text, revolutionizing communication and content creation. As we continue to develop these technologies, it becomes crucial to consider their ethical implications and ensure they benefit society as a whole. The future of AI holds immense potential for solving complex global challenges, but it also requires careful consideration of privacy, security, and the impact on employment markets.",
                science: "Climate change represents one of the most pressing challenges of our time, requiring immediate action from governments, businesses, and individuals worldwide. The effects of global warming are already visible in rising sea levels, extreme weather patterns, and shifting ecosystems that threaten biodiversity. Scientists have developed innovative solutions including renewable energy technologies, carbon capture systems, and sustainable agriculture practices. Solar and wind power have become increasingly cost-effective alternatives to fossil fuels, while electric vehicles are revolutionizing transportation. However, addressing climate change requires coordinated global efforts, policy changes, and individual lifestyle modifications. The transition to a sustainable future depends on our collective commitment to reducing greenhouse gas emissions and protecting our planet for future generations.",
                history: "The Renaissance period, spanning roughly from the 14th to the 17th century, marked a profound transformation in European culture, art, and intellectual thought. This era witnessed the revival of classical learning, the flourishing of artistic expression, and groundbreaking scientific discoveries. Prominent figures like Leonardo da Vinci embodied the Renaissance ideal of the polymath, excelling in art, science, and engineering. The invention of the printing press by Johannes Gutenberg revolutionized the spread of knowledge, making books more accessible and accelerating the exchange of ideas. Renaissance humanism emphasized the potential and worth of individual human beings, shifting focus from purely religious concerns to secular learning and personal achievement. This period laid the foundation for the modern world, influencing everything from artistic techniques to scientific methodology.",
                literature: "Literature serves as a mirror to society, reflecting the values, struggles, and aspirations of different cultures and time periods. Through storytelling, authors have the power to transport readers to different worlds, challenge perspectives, and evoke deep emotional responses. Classic works like Shakespeare's plays continue to resonate with modern audiences because they explore universal themes of love, ambition, betrayal, and redemption. Contemporary literature addresses current social issues, giving voice to marginalized communities and exploring the complexities of modern life. The digital age has transformed how we consume literature, with e-books, audiobooks, and online platforms making literary works more accessible than ever before. Reading literature not only provides entertainment but also develops empathy, critical thinking skills, and cultural understanding."
            },
            tr: {
                ai: "Yapay zekanÄ±n hÄ±zlÄ± ilerlemesi, gÃ¼nlÃ¼k yaÅŸamÄ±n sayÄ±sÄ±z endÃ¼strisini ve yÃ¶nÃ¼nÃ¼ dÃ¶nÃ¼ÅŸtÃ¼rmÃ¼ÅŸtÃ¼r. SaÄŸlÄ±k teÅŸhislerinden otonom araÃ§lara kadar, AI sistemleri giderek daha sofistike ve yetenekli hale gelmektedir. Makine Ã¶ÄŸrenmesi algoritmalarÄ± artÄ±k bÃ¼yÃ¼k miktarlarda veriyi iÅŸleyerek kalÄ±plarÄ± tanÄ±mlayabilir ve olaÄŸanÃ¼st   doÄŸrulukla tahminlerde bulunabilir. DoÄŸal dil iÅŸleme, bilgisayarlarÄ±n insan benzeri metinleri anlamasÄ±nÄ± ve Ã¼retmesini saÄŸlayarak iletiÅŸim ve iÃ§erik oluÅŸturmada devrim yaratmÄ±ÅŸtÄ±r. Bu teknolojileri geliÅŸtirmeye devam ederken, etik sonuÃ§larÄ±nÄ± gÃ¶z Ã¶nÃ¼nde bulundurmak ve topluma bir bÃ¼tÃ¼n olarak fayda saÄŸlamalarÄ±nÄ± garanti etmek Ã§ok Ã¶nemli hale gelmiÅŸtir. AI'nÄ±n geleceÄŸi karmaÅŸÄ±k kÃ¼resel zorluklarÄ± Ã§Ã¶zmek iÃ§in muazzam potansiyel barÄ±ndÄ±rÄ±yor, ancak aynÄ± zamanda gizlilik, gÃ¼venlik ve istihdam piyasalarÄ±na etkisi konularÄ±nda dikkatli deÄŸerlendirme gerektiriyor.",
                science: "Ä°klim deÄŸiÅŸikliÄŸi, dÃ¼nya Ã§apÄ±nda hÃ¼kÃ¼metler, iÅŸletmeler ve bireylerden acil eylem gerektiren zamanÄ±mÄ±zÄ±n en acil zorluklarÄ±ndan birini temsil etmektedir. KÃ¼resel Ä±sÄ±nmanÄ±n etkileri, yÃ¼kselen deniz seviyeleri, aÅŸÄ±rÄ± hava durumu kalÄ±plarÄ± ve biyoÃ§eÅŸitliliÄŸi tehdit eden deÄŸiÅŸen ekosistemlerde zaten gÃ¶rÃ¼lmektedir. Bilim insanlarÄ± yenilenebilir enerji teknolojileri, karbon yakalama sistemleri ve sÃ¼rdÃ¼rÃ¼lebilir tarÄ±m uygulamalarÄ± dahil olmak Ã¼zere yenilikÃ§i Ã§Ã¶zÃ¼mler geliÅŸtirmiÅŸtir. GÃ¼neÅŸ ve rÃ¼zgar enerjisi, fosil yakÄ±tlara giderek daha uygun maliyetli alternatifler haline gelirken, elektrikli araÃ§lar ulaÅŸÄ±mda devrim yaratmaktadÄ±r. Ancak iklim deÄŸiÅŸikliÄŸiyle mÃ¼cadele, koordineli kÃ¼resel Ã§abalar, politika deÄŸiÅŸiklikleri ve bireysel yaÅŸam tarzÄ± deÄŸi    iklikleri gerektirmektedir.",
                history: "YaklaÅŸÄ±k 14. yÃ¼zyÄ±ldan 17. yÃ¼zyÄ±la kadar uzanan RÃ¶nesans dÃ¶nemi, Avrupa kÃ¼ltÃ¼rÃ¼, sanatÄ± ve entelektÃ¼el dÃ¼ÅŸÃ¼ncesinde derin bir dÃ¶nÃ¼ÅŸÃ¼mÃ¼ iÅŸaret etmiÅŸtir. Bu Ã§aÄŸ, klasik Ã¶ÄŸrenimin yeniden canlanmasÄ±, sanatsal ifadenin Ã§iÃ§eklenmesi ve Ã§Ä±ÄŸÄ±r aÃ§an bilimsel keÅŸiflere tanÄ±k olmuÅŸtur. Leonardo da Vinci gibi Ã¶nde gelen figÃ¼rler, sanat, bilim ve mÃ¼hendislikte mÃ¼kemmelleÅŸerek RÃ¶nesans'Ä±n Ã§ok yÃ¶nlÃ¼ insan idealini somutlaÅŸtÄ±rmÄ±ÅŸtÄ±r. Johannes Gutenberg'in matbaayÄ± icat etmesi bilginin yayÄ±lmasÄ±nda devrim yaratarak kitaplarÄ± daha eriÅŸilebilir hale getirdi ve fikirlerin deÄŸiÅŸimini hÄ±zlandÄ±rdÄ±. RÃ¶nesans hÃ¼manizmi, bireysel insanlarÄ±n potansiyeli ve deÄŸerini vurgulayarak odaÄŸÄ± tamamen dini kaygÄ±lardan laik Ã¶ÄŸrenime ve kiÅŸisel baÅŸarÄ±ya kaydÄ±rmÄ±ÅŸtÄ±r.",
                literature: "Edebiyat topluma bir ayna gÃ¶revi gÃ¶rerek farklÄ± kÃ¼ltÃ¼rlerin ve zaman dilimlerinin deÄŸerlerini, mÃ¼cadelelerini ve Ã¶zlemlerini yansÄ±tÄ±r. Hikaye anlatÄ±cÄ±lÄ±ÄŸÄ± yoluyla yazarlar, okuyucularÄ± farklÄ± dÃ¼nyalara taÅŸÄ±ma, bakÄ±ÅŸ aÃ§Ä±larÄ±nÄ± sorgulama ve derin duygusal tepkiler uyandÄ±rma gÃ¼cÃ¼ne sahiptir. Shakespeare'in oyunlarÄ± gibi klasik eserler, aÅŸk, hÄ±rs, ihanet ve kurtuluÅŸ gibi evrensel temalarÄ± keÅŸfettikleri iÃ§in modern izleyicilerle rezonans kurmaya devam etmektedir. Ã‡aÄŸdaÅŸ edebiyat gÃ¼ncel sosyal konularÄ± ele alarak marjinalleÅŸtirilmiÅŸ topluluklara ses veriyor ve modern yaÅŸamÄ±n karmaÅŸÄ±klÄ±klarÄ±nÄ± keÅŸfediyor. Dijital Ã§aÄŸ, e-kitaplar, sesli kitaplar ve Ã§evrimiÃ§i platformlarla edebi eserleri her zamankinden daha eriÅŸilebilir hale getirerek edebiyatÄ± nasÄ±l tÃ¼kettiÄŸimizi dÃ¶nÃ¼ÅŸtÃ¼rmÃ¼ÅŸtÃ¼r."
            },
            it: {
                ai: "Il rapido progresso dell'intelligenza artificiale ha trasformato numerose industrie e aspetti della vita quotidiana. Dalla diagnostica sanitaria ai veicoli autonomi, i sistemi AI stanno diventando sempre piÃ¹ sofisticati e capaci. Gli algoritmi di machine learning possono ora elaborare enormi quantitÃ  di dati per identificare modelli e fare previsioni con notevole precisione. L'elaborazione del linguaggio naturale ha permesso ai computer di comprendere e generare testo simile a quello umano, rivoluzionando la comunicazione e la creazione di contenuti. Mentre continuiamo a sviluppare queste tecnologie, diventa cruciale considerare le loro implicazioni etiche e assicurarsi che beneficino la societÃ  nel suo insieme. Il futuro dell'AI ha un potenziale immenso per risolvere sfide globali complesse, ma richiede anche un'attenta considerazione della privacy, sicurezza e dell'impatto sui mercati del lavoro.",
                science: "Il cambiamento climatico rappresenta una delle sfide piÃ¹ urgenti del nostro tempo, richiedendo azione immediata da governi, aziende e individui in tutto il mondo. Gli effetti del riscaldamento globale sono giÃ  visibili nell'innalzamento del livello del mare, nei modelli meteorologici estremi e negli ecosistemi in cambiamento che minacciano la biodiversitÃ . Gli scienziati hanno sviluppato soluzioni innovative incluse tecnologie di energia rinnovabile, sistemi di cattura del carbonio e pratiche agricole sostenibili. L'energia solare ed eolica sono diventate alternative sempre piÃ¹ convenienti ai combustibili fossili, mentre i veicoli elettrici stanno rivoluzionando i trasporti. Tuttavia, affrontare il cambiamento climatico richiede sforzi globali coordinati, cambiamenti politici e modifiche dello stile di vita individuale.",
                history: "Il periodo del Rinascimento, che va approssimativamente dal XIV al XVII secolo, ha segnato una profonda trasformazione nella cultura europea, nell'arte e nel pensiero intellettuale. Quest'era ha assistito al revival dell'apprendimento classico, al fiorire dell'espressione artistica e a scoperte scientifiche rivoluzionarie. Figure prominenti come Leonardo da Vinci incarnavano l'ideale rinascimentale del polimata, eccellendo nell'arte, nella scienza e nell'ingegneria. L'invenzione della stampa da parte di Johannes Gutenberg rivoluzion   la diffusione della conoscenza, rendendo i libri piÃ¹ accessibili e accelerando lo scambio di idee. L'umanesimo rinascimentale enfatizzava il potenziale e il valore degli esseri umani individuali, spostando l'attenzione dalle preoccupazioni puramente religiose all'apprendimento secolare e al successo personale.",
                literature: "La letteratura serve come specchio della societÃ , riflettendo i valori, le lotte e le aspirazioni di diverse culture e periodi storici. Attraverso la narrazione, gli autori hanno il potere di trasportare i lettori in mondi diversi, sfidare le prospettive ed evocare profonde risposte emotive. Opere classiche come le opere di Shakespeare continuano a risuonare con il pubblico moderno perchÃ© esplorano temi universali di amore, ambizione, tradimento e redenzione. La letteratura contemporanea affronta questioni sociali attuali, dando voce alle comunitÃ  emarginate ed esplorando le complessitÃ  della vita moderna. L'era digitale ha trasformato il modo in cui consumiamo la letteratura, con e-book, audiolibri e piattaforme online che rendono le opere letterarie piÃ¹ accessibili che mai."
            }
        };

        // Global function declarations - these must be in global scope
        window.showSection = function(sectionName) {
            console.log('Navigating to section:', sectionName);
            
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('Showing section:', sectionName);
            } else {
                console.error('Section not found:', sectionName + 'Section');
            }
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('text-white');
                btn.classList.add('text-gray-300');
            });
            
            // Find and highlight the active button
            const activeButton = document.querySelector(`button[onclick*="${sectionName}"]`);
            if (activeButton) {
                activeButton.classList.remove('text-gray-300');
                activeButton.classList.add('text-white');
            }
            
            currentSection = sectionName;
            
            // Load section-specific data
            if (sectionName === 'profile') {
                loadProfileData();
            }
        };

        window.showAuth = function() {
            document.getElementById('authModal').classList.remove('hidden');
        };

        window.closeAuth = function() {
            document.getElementById('authModal').classList.add('hidden');
        };

        window.togglePassword = function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        };

        window.toggleAuthMode = function() {
            const modal = document.getElementById('authModal');
            const isSignUp = modal.dataset.mode === 'signup';
            
            if (isSignUp) {
                // Switch to sign in
                modal.dataset.mode = 'signin';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_welcome');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_welcome;
                modal.querySelector('p').setAttribute('data-translate', 'auth_signin_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signin_subtitle;
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signin;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'login()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_no_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_no_account;
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signup;
            } else {
                // Switch to sign up
                modal.dataset.mode = 'signup';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_create_account');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_create_account || 'Create Account';
                modal.querySelector('p').setAttribute('data-translate', 'auth_signup_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signup_subtitle || 'Sign up for a new account';
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signup;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'signup()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_have_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_have_account || 'Already have an account? ';
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signin;
            }
        };
        
        window.signup = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignUp(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification('Account created successfully!', 'success');
            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Error creating account';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'This email is already registered';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak';
                }
                showNotification(errorMessage, 'error');
            }
        };

        window.login = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification(translations[currentLanguage].notif_login_failed + 'Please fill in all fields', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification(translations[currentLanguage].notif_login_success, 'success');
                
                // Load user's test data from Firebase
                await loadUserTestDataFromFirebase(user.uid);
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Invalid email or password';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No account found with this email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Incorrect password';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                }
                showNotification(translations[currentLanguage].notif_login_failed + errorMessage, 'error');
            }
        };

        window.logout = async function() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userTestData');
                updateUIForLoggedOutUser();
                showNotification('Successfully logged out', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Error logging out', 'error');
            }
        };

        window.toggleProfileMenu = function() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('hidden');
        };

        window.closeProfileMenu = function() {
            document.getElementById('profileDropdown').classList.add('hidden');
        };

        window.changeLanguage = function() {
            const selector = document.getElementById('languageSelector');
            currentLanguage = selector.value;
            
            // Update speech recognition language
            if (recognition) {
                recognition.lang = currentLanguage === 'tr' ? 'tr-TR' : currentLanguage === 'it' ? 'it-IT' : 'en-US';
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Update placeholder texts
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            // Update preset text if needed
            loadPresetText();
        };



        window.loadPresetText = function() {
            const select = document.getElementById('presetTextSelect');
            const textType = select.value;
            const textContent = presetTexts[currentLanguage] && presetTexts[currentLanguage][textType] 
                ? presetTexts[currentLanguage][textType] 
                : presetTexts.en[textType];
            
            document.getElementById('testText1').textContent = textContent;
            currentTestText = textContent;
            currentWordCount = textContent.split(/\s+/).length;
            
            document.getElementById('testText2').innerHTML = convertToBionic(textContent);
        };

        window.loadCustomText = function() {
            const customText = document.getElementById('customTestText').value.trim();
            if (!customText) {
                showNotification('Please enter some text first', 'error');
                return;
            }
            
            if (customText.split(/\s+/).length < 50) {
                showNotification('Text should be at least 50 words for accurate testing', 'warning');
            }
            
            document.getElementById('customDisplayText').textContent = customText;
            document.getElementById('customTextDisplay').classList.remove('hidden');
            
            document.getElementById('testText1').textContent = customText;
            document.getElementById('testText2').innerHTML = convertToBionic(customText);
            
            currentTestText = customText;
            currentWordCount = customText.split(/\s+/).length;
        };

        window.startTimer = function(step) {
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            const timer = document.getElementById(`timer${step}`);
            
            startBtn.disabled = true;
            finishBtn.disabled = false;
            
            testStartTimes[step] = Date.now();
            
            testTimers[step] = setInterval(() => {
                const elapsed = Date.now() - testStartTimes[step];
                const seconds = Math.floor(elapsed / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        };

        window.finishTimer = function(step) {
            if (!testTimers[step]) return;
            
            clearInterval(testTimers[step]);
            testTimers[step] = null;
            
            const elapsed = Date.now() - testStartTimes[step];
            const minutes = elapsed / 60000;
            const wordsPerMinute = Math.round(currentWordCount / minutes);
            
            if (step === 1) {
                testResults.normal = wordsPerMinute;
                document.getElementById('testStep2').classList.remove('hidden');
                document.getElementById('testStep2').scrollIntoView({ behavior: 'smooth' });
            } else {
                testResults.bionic = wordsPerMinute;
                showTestResults();
            }
            
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            startBtn.disabled = false;
            finishBtn.disabled = true;
        };

        window.resetTest = function() {
            Object.keys(testTimers).forEach(key => {
                if (testTimers[key]) {
                    clearInterval(testTimers[key]);
                    testTimers[key] = null;
                }
            });
            
            document.getElementById('testStep2').classList.add('hidden');
            document.getElementById('testResults').classList.add('hidden');
            
            document.getElementById('timer1').textContent = '00:00';
            document.getElementById('timer2').textContent = '00:00';
            
            document.getElementById('startBtn1').disabled = false;
            document.getElementById('finishBtn1').disabled = true;
            document.getElementById('startBtn2').disabled = false;
            document.getElementById('finishBtn2').disabled = true;
            
            testResults = { normal: 0, bionic: 0 };
            
            document.getElementById('testStep1').scrollIntoView({ behavior: 'smooth' });
        };

        window.downloadResults = function() {
            const results = {
                date: new Date().toLocaleDateString(),
                normalSpeed: testResults.normal,
                bionicSpeed: testResults.bionic,
                improvement: testResults.bionic > testResults.normal ? 
                    Math.round(((testResults.bionic - testResults.normal) / testResults.normal) * 100) : 0
            };
            
            const report = `
BionicText AI - Reading Speed Test Results
==========================================

Test Date: ${results.date}
Text Word Count: ${currentWordCount} words

Results:
--------
Normal Text Speed: ${results.normalSpeed} WPM
BionicText Speed: ${results.bionicSpeed} WPM
Speed Improvement: +${results.improvement}%

Analysis:
---------
${results.improvement > 0 ? 
    `Congratulations! You read ${results.improvement}% faster with BionicText formatting.` :
    'Keep practicing! BionicText can help improve your reading speed over time.'
}

Generated by BionicText AI
            `.trim();
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-results-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        // Converter functions
        window.setInputMode = function(mode) {
            const buttons = document.querySelectorAll('.input-mode-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            
            const modes = document.querySelectorAll('.input-mode');
            modes.forEach(m => m.classList.add('hidden'));
            
            document.getElementById(mode + 'InputMode').classList.remove('hidden');
        };

        window.handleFileUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                document.getElementById('inputText').value = text;
                showNotification('File loaded successfully!', 'success');
            };
            reader.readAsText(file);
        };

        window.toggleVoiceRecording = function() {
            if (!recognition) {
                showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        };

        window.convertText = function() {
            let inputText = '';
            
            const activeMode = document.querySelector('.input-mode:not(.hidden)');
            if (activeMode.id === 'textInputMode') {
                inputText = document.getElementById('inputText').value.trim();
            } else if (activeMode.id === 'customTextMode') {
                inputText = document.getElementById('customTestText').value.trim();
            }
            
            if (!inputText) {
                showNotification('Please enter some text to convert', 'error');
                return;
            }
            
            const bionicText = convertToBionic(inputText);
            document.getElementById('bionicOutput').innerHTML = bionicText;
            
            showNotification('Text converted to BionicText format!', 'success');
        };

        window.updateFontSize = function() {
            const fontSize = document.getElementById('fontSize').value;
            document.getElementById('bionicOutput').style.fontSize = fontSize + 'px';
        };

        window.updateFontFamily = function() {
            const fontFamily = document.getElementById('fontFamily').value;
            document.getElementById('bionicOutput').style.fontFamily = fontFamily;
        };

        window.exportToPDF = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to export. Convert some text first!', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('BionicText exported successfully!', 'success');
        };

        window.exportToTXT = function() {
            exportToPDF();
        };

        window.speakText = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to speak. Convert some text first!', 'error');
                return;
            }
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(content);
                const language = document.getElementById('voiceLanguage').value;
                const speed = parseFloat(document.getElementById('voiceSpeed').value);
                
                utterance.lang = language;
                utterance.rate = speed;
                
                speechSynthesis.speak(utterance);
                showNotification('Speaking text...', 'info');
            } else {
                showNotification('Text-to-speech not supported in this browser', 'error');
            }
        };

        // AI Assistant functions
        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessageToChat('user', message);
            input.value = '';
            
            setTimeout(() => {
                const response = generateAIResponse(message);
                addMessageToChat('ai', response);
            }, 1000);
        };

        window.sendQuickMessage = function(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        };

        window.clearChat = function() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
                        <p class="text-gray-800" data-translate="assistant_welcome">Hello! I'm your BionicText AI Assistant.</p>
                    </div>
                </div>
            `;
        };

        window.handleChatKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        };

        // Profile functions
        window.exportAllData = function() {
            const testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
            
            if (testData.length === 0) {
                showNotification(translations[currentLanguage].notif_no_data_export, 'warning');
                return;
            }
            
            const csvContent = [
                'Date,Normal WPM,BionicText WPM,Improvement %,Text Type,Word Count',
                ...testData.map(test => 
                    `${new Date(test.date).toLocaleDateString()},${test.normalWPM},${test.bionicWPM},${test.improvement},${test.textType},${test.wordCount}`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        window.deleteAllData = async function() {
            if (confirm('Are you sure you want to delete all your test data? This cannot be undone.')) {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const userData = JSON.parse(currentUser);
                    await deleteAllDataFromFirebase(userData.uid);
                } else {
                    localStorage.removeItem('userTestData');
                    loadProfileData();
                    showNotification(translations[currentLanguage].notif_data_deleted, 'success');
                }
            }
        };

        window.hideNotification = function() {
            document.getElementById('notification').classList.add('hidden');
        };

        // Firebase functions
        async function loadUserTestDataFromFirebase(userId) {
            try {
                const q = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, 'testResults'),
                    window.firebaseWhere('userId', '==', userId),
                    window.firebaseOrderBy('timestamp', 'desc')
                );
                
                const querySnapshot = await window.firebaseGetDocs(q);
                const testData = [];
                
                querySnapshot.forEach((doc) => {
                    testData.push(doc.data());
                });
                
                localStorage.setItem('userTestData', JSON.stringify(testData));
                
                if (currentSection === 'profile') {
                    loadProfileData();
                }
            } catch (error) {
                console.error('Error loading test data:', error);
            }
        }

        async function deleteAllDataFromFirebase(userId) {
            try {
                const q = window.firebaseQuery(
                    window.firebaseCollection(window.firebaseDb, 'testResults'),
                    window.firebaseWhere('userId', '==', userId)
                );
                
                const querySnapshot = await window.firebaseGetDocs(q);
                const deletePromises = [];
                
                querySnapshot.forEach((docSnapshot) => {
                    deletePromises.push(
                        window.firebaseDeleteDoc(window.firebaseDoc(window.firebaseDb, 'testResults', docSnapshot.id))
                    );
                });
                
                await Promise.all(deletePromises);
                localStorage.removeItem('userTestData');
                
                showNotification(translations[currentLanguage].notif_data_deleted, 'success');
                loadProfileData();
            } catch (error) {
                console.error('Error deleting data:', error);
                showNotification('Error deleting data from cloud', 'error');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            
            // Set initial language
            changeLanguage();
            
            // Initialize speech recognition if available
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = currentLanguage === 'tr' ? 'tr-TR' : currentLanguage === 'it' ? 'it-IT' : 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('inputText').value = transcript;
                    stopRecording();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    stopRecording();
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }

            // Load user data from localStorage
            loadUserData();
            
            // Check Firebase auth state
            window.firebaseAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    const userData = {
                        uid: user.uid,
                        email: user.email,
                        name: user.email.split('@')[0],
                        joinDate: new Date().toISOString().split('T')[0]
                    };
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    updateUIForLoggedInUser(userData);
                    await loadUserTestDataFromFirebase(user.uid);
                } else {
                    updateUIForLoggedOutUser();
                }
            });
            
            // Update custom text word count
            const customTextArea = document.getElementById('customTestText');
            if (customTextArea) {
                customTextArea.addEventListener('input', updateCustomWordCount);
            }

            // Load settings
            setTimeout(() => {
                loadSettings();
            }, 100);
            
            console.log('App initialization complete');
        });

        // Global function declarations - these must be in global scope
        window.showSection = function(sectionName) {
            console.log('Navigating to section:', sectionName);
            
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('Showing section:', sectionName);
            } else {
                console.error('Section not found:', sectionName + 'Section');
            }
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('text-white');
                btn.classList.add('text-gray-300');
            });
            
            // Find and highlight the active button
            const activeButton = document.querySelector(`button[onclick*="${sectionName}"]`);
            if (activeButton) {
                activeButton.classList.remove('text-gray-300');
                activeButton.classList.add('text-white');
            }
            
            currentSection = sectionName;
            
            // Load section-specific data
            if (sectionName === 'profile') {
                loadProfileData();
            }
        };

        window.showAuth = function() {
            document.getElementById('authModal').classList.remove('hidden');
        };

        window.closeAuth = function() {
            document.getElementById('authModal').classList.add('hidden');
        };

        window.togglePassword = function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        };

        window.toggleAuthMode = function() {
            const modal = document.getElementById('authModal');
            const isSignUp = modal.dataset.mode === 'signup';
            
            if (isSignUp) {
                // Switch to sign in
                modal.dataset.mode = 'signin';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_welcome');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_welcome;
                modal.querySelector('p').setAttribute('data-translate', 'auth_signin_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signin_subtitle;
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signin;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'login()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_no_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_no_account;
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signup;
            } else {
                // Switch to sign up
                modal.dataset.mode = 'signup';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_create_account');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_create_account || 'Create Account';
                modal.querySelector('p').setAttribute('data-translate', 'auth_signup_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signup_subtitle || 'Sign up for a new account';
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signup;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'signup()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_have_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_have_account || 'Already have an account? ';
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signin;
            }
        };
        
        window.signup = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignUp(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification('Account created successfully!', 'success');
            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Error creating account';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'This email is already registered';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak';
                }
                showNotification(errorMessage, 'error');
            }
        };

        window.login = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification(translations[currentLanguage].notif_login_failed + 'Please fill in all fields', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification(translations[currentLanguage].notif_login_success, 'success');
                
                // Load user's test data from Firebase
                await loadUserTestDataFromFirebase(user.uid);
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Invalid email or password';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No account found with this email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Incorrect password';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                }
                showNotification(translations[currentLanguage].notif_login_failed + errorMessage, 'error');
            }
        };

        window.logout = async function() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userTestData');
                updateUIForLoggedOutUser();
                showNotification('Successfully logged out', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Error logging out', 'error');
            }
        };

        window.toggleProfileMenu = function() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('hidden');
        };

        window.closeProfileMenu = function() {
            document.getElementById('profileDropdown').classList.add('hidden');
        };

        window.changeLanguage = function() {
            const selector = document.getElementById('languageSelector');
            currentLanguage = selector.value;
            
            // Update speech recognition language
            if (recognition) {
                recognition.lang = currentLanguage === 'tr' ? 'tr-TR' : currentLanguage === 'it' ? 'it-IT' : 'en-US';
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Update placeholder texts
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            // Update preset text if needed
            loadPresetText();
        };



        window.loadPresetText = function() {
            const select = document.getElementById('presetTextSelect');
            const textType = select.value;
            const textContent = presetTexts[currentLanguage] && presetTexts[currentLanguage][textType] 
                ? presetTexts[currentLanguage][textType] 
                : presetTexts.en[textType];
            
            document.getElementById('testText1').textContent = textContent;
            currentTestText = textContent;
            currentWordCount = textContent.split(/\s+/).length;
            
            document.getElementById('testText2').innerHTML = convertToBionic(textContent);
        };

        window.loadCustomText = function() {
            const customText = document.getElementById('customTestText').value.trim();
            if (!customText) {
                showNotification('Please enter some text first', 'error');
                return;
            }
            
            if (customText.split(/\s+/).length < 50) {
                showNotification('Text should be at least 50 words for accurate testing', 'warning');
            }
            
            document.getElementById('customDisplayText').textContent = customText;
            document.getElementById('customTextDisplay').classList.remove('hidden');
            
            document.getElementById('testText1').textContent = customText;
            document.getElementById('testText2').innerHTML = convertToBionic(customText);
            
            currentTestText = customText;
            currentWordCount = customText.split(/\s+/).length;
        };

        window.startTimer = function(step) {
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            const timer = document.getElementById(`timer${step}`);
            
            startBtn.disabled = true;
            finishBtn.disabled = false;
            
            testStartTimes[step] = Date.now();
            
            testTimers[step] = setInterval(() => {
                const elapsed = Date.now() - testStartTimes[step];
                const seconds = Math.floor(elapsed / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        };

        window.finishTimer = function(step) {
            if (!testTimers[step]) return;
            
            clearInterval(testTimers[step]);
            testTimers[step] = null;
            
            const elapsed = Date.now() - testStartTimes[step];
            const minutes = elapsed / 60000;
            const wordsPerMinute = Math.round(currentWordCount / minutes);
            
            if (step === 1) {
                testResults.normal = wordsPerMinute;
                document.getElementById('testStep2').classList.remove('hidden');
                document.getElementById('testStep2').scrollIntoView({ behavior: 'smooth' });
            } else {
                testResults.bionic = wordsPerMinute;
                showTestResults();
            }
            
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            startBtn.disabled = false;
            finishBtn.disabled = true;
        };

        window.resetTest = function() {
            Object.keys(testTimers).forEach(key => {
                if (testTimers[key]) {
                    clearInterval(testTimers[key]);
                    testTimers[key] = null;
                }
            });
            
            document.getElementById('testStep2').classList.add('hidden');
            document.getElementById('testResults').classList.add('hidden');
            
            document.getElementById('timer1').textContent = '00:00';
            document.getElementById('timer2').textContent = '00:00';
            
            document.getElementById('startBtn1').disabled = false;
            document.getElementById('finishBtn1').disabled = true;
            document.getElementById('startBtn2').disabled = false;
            document.getElementById('finishBtn2').disabled = true;
            
            testResults = { normal: 0, bionic: 0 };
            
            document.getElementById('testStep1').scrollIntoView({ behavior: 'smooth' });
        };

        window.downloadResults = function() {
            const results = {
                date: new Date().toLocaleDateString(),
                normalSpeed: testResults.normal,
                bionicSpeed: testResults.bionic,
                improvement: testResults.bionic > testResults.normal ? 
                    Math.round(((testResults.bionic - testResults.normal) / testResults.normal) * 100) : 0
            };
            
            const report = `
BionicText AI - Reading Speed Test Results
==========================================

Test Date: ${results.date}
Text Word Count: ${currentWordCount} words

Results:
--------
Normal Text Speed: ${results.normalSpeed} WPM
BionicText Speed: ${results.bionicSpeed} WPM
Speed Improvement: +${results.improvement}%

Analysis:
---------
${results.improvement > 0 ? 
    `Congratulations! You read ${results.improvement}% faster with BionicText formatting.` :
    'Keep practicing! BionicText can help improve your reading speed over time.'
}

Generated by BionicText AI
            `.trim();
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-results-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        // Converter functions
        window.setInputMode = function(mode) {
            const buttons = document.querySelectorAll('.input-mode-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            
            const modes = document.querySelectorAll('.input-mode');
            modes.forEach(m => m.classList.add('hidden'));
            
            document.getElementById(mode + 'InputMode').classList.remove('hidden');
        };

        window.handleFileUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                document.getElementById('inputText').value = text;
                showNotification('File loaded successfully!', 'success');
            };
            reader.readAsText(file);
        };

        window.toggleVoiceRecording = function() {
            if (!recognition) {
                showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        };

        window.convertText = function() {
            let inputText = '';
            
            const activeMode = document.querySelector('.input-mode:not(.hidden)');
            if (activeMode.id === 'textInputMode') {
                inputText = document.getElementById('inputText').value.trim();
            } else if (activeMode.id === 'customTextMode') {
                inputText = document.getElementById('customTestText').value.trim();
            }
            
            if (!inputText) {
                showNotification('Please enter some text to convert', 'error');
                return;
            }
            
            const bionicText = convertToBionic(inputText);
            document.getElementById('bionicOutput').innerHTML = bionicText;
            
            showNotification('Text converted to BionicText format!', 'success');
        };

        window.updateFontSize = function() {
            const fontSize = document.getElementById('fontSize').value;
            document.getElementById('bionicOutput').style.fontSize = fontSize + 'px';
        };

        window.updateFontFamily = function() {
            const fontFamily = document.getElementById('fontFamily').value;
            document.getElementById('bionicOutput').style.fontFamily = fontFamily;
        };

        window.exportToPDF = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to export. Convert some text first!', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('BionicText exported successfully!', 'success');
        };

        window.exportToTXT = function() {
            exportToPDF();
        };

        window.speakText = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to speak. Convert some text first!', 'error');
                return;
            }
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(content);
                const language = document.getElementById('voiceLanguage').value;
                const speed = parseFloat(document.getElementById('voiceSpeed').value);
                
                utterance.lang = language;
                utterance.rate = speed;
                
                speechSynthesis.speak(utterance);
                showNotification('Speaking text...', 'info');
            } else {
                showNotification('Text-to-speech not supported in this browser', 'error');
            }
        };

        // AI Assistant functions
        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessageToChat('user', message);
            input.value = '';
            
            setTimeout(() => {
                const response = generateAIResponse(message);
                addMessageToChat('ai', response);
            }, 1000);
        };

        window.sendQuickMessage = function(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        };

        window.clearChat = function() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
                        <p class="text-gray-800" data-translate="assistant_welcome">Hello! I'm your BionicText AI Assistant.</p>
                    </div>
                </div>
            `;
        };

        window.handleChatKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        };

        // Profile functions
        window.exportAllData = function() {
            const testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
            
            if (testData.length === 0) {
                showNotification(translations[currentLanguage].notif_no_data_export, 'warning');
                return;
            }
            
            const csvContent = [
                'Date,Normal WPM,BionicText WPM,Improvement %,Text Type,Word Count',
                ...testData.map(test => 
                    `${new Date(test.date).toLocaleDateString()},${test.normalWPM},${test.bionicWPM},${test.improvement},${test.textType},${test.wordCount}`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        window.deleteAllData = async function() {
            if (confirm('Are you sure you want to delete all your test data? This cannot be undone.')) {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const userData = JSON.parse(currentUser);
                    await deleteAllDataFromFirebase(userData.uid);
                } else {
                    localStorage.removeItem('userTestData');
                    loadProfileData();
                    showNotification(translations[currentLanguage].notif_data_deleted, 'success');
                }
            }
        };

        window.hideNotification = function() {
            document.getElementById('notification').classList.add('hidden');
        };

        window.showAuth = function() {
            document.getElementById('authModal').classList.remove('hidden');
        };

        window.closeAuth = function() {
            document.getElementById('authModal').classList.add('hidden');
        };

        window.togglePassword = function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        };

        window.toggleAuthMode = function() {
            const modal = document.getElementById('authModal');
            const isSignUp = modal.dataset.mode === 'signup';
            
            if (isSignUp) {
                // Switch to sign in
                modal.dataset.mode = 'signin';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_welcome');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_welcome;
                modal.querySelector('p').setAttribute('data-translate', 'auth_signin_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signin_subtitle;
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signin;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'login()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_no_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_no_account;
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signup;
            } else {
                // Switch to sign up
                modal.dataset.mode = 'signup';
                modal.querySelector('h2').setAttribute('data-translate', 'auth_create_account');
                modal.querySelector('h2').textContent = translations[currentLanguage].auth_create_account || 'Create Account';
                modal.querySelector('p').setAttribute('data-translate', 'auth_signup_subtitle');
                modal.querySelector('p').textContent = translations[currentLanguage].auth_signup_subtitle || 'Sign up for a new account';
                modal.querySelector('button[onclick="login()"]').setAttribute('data-translate', 'auth_signup');
                modal.querySelector('button[onclick="login()"]').textContent = translations[currentLanguage].auth_signup;
                modal.querySelector('button[onclick="login()"]').setAttribute('onclick', 'signup()');
                modal.querySelectorAll('.space-y-3 span')[0].setAttribute('data-translate', 'auth_have_account');
                modal.querySelectorAll('.space-y-3 span')[0].textContent = translations[currentLanguage].auth_have_account || 'Already have an account? ';
                modal.querySelector('button[onclick="toggleAuthMode()"]').setAttribute('data-translate', 'auth_signin');
                modal.querySelector('button[onclick="toggleAuthMode()"]').textContent = translations[currentLanguage].auth_signin;
            }
        };
        
        window.signup = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignUp(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification('Account created successfully!', 'success');
            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Error creating account';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'This email is already registered';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak';
                }
                showNotification(errorMessage, 'error');
            }
        };

        window.login = async function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (!email || !password) {
                showNotification(translations[currentLanguage].notif_login_failed + 'Please fill in all fields', 'error');
                return;
            }

            try {
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    name: user.email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification(translations[currentLanguage].notif_login_success, 'success');
                
                // Load user's test data from Firebase
                await loadUserTestDataFromFirebase(user.uid);
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Invalid email or password';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No account found with this email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Incorrect password';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email format';
                }
                showNotification(translations[currentLanguage].notif_login_failed + errorMessage, 'error');
            }
        };

        window.logout = async function() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userTestData');
                updateUIForLoggedOutUser();
                showNotification('Successfully logged out', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Error logging out', 'error');
            }
        };

        window.toggleProfileMenu = function() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('hidden');
        };

        window.closeProfileMenu = function() {
            document.getElementById('profileDropdown').classList.add('hidden');
        };

        window.changeLanguage = function() {
            const selector = document.getElementById('languageSelector');
            currentLanguage = selector.value;
            
            // Update speech recognition language
            if (recognition) {
                recognition.lang = currentLanguage === 'tr' ? 'tr-TR' : currentLanguage === 'it' ? 'it-IT' : 'en-US';
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Update placeholder texts
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            // Update preset text if needed
            loadPresetText();
        };



        window.loadPresetText = function() {
            const select = document.getElementById('presetTextSelect');
            const textType = select.value;
            const textContent = presetTexts[currentLanguage] && presetTexts[currentLanguage][textType] 
                ? presetTexts[currentLanguage][textType] 
                : presetTexts.en[textType];
            
            document.getElementById('testText1').textContent = textContent;
            currentTestText = textContent;
            currentWordCount = textContent.split(/\s+/).length;
            
            document.getElementById('testText2').innerHTML = convertToBionic(textContent);
        };

        window.loadCustomText = function() {
            const customText = document.getElementById('customTestText').value.trim();
            if (!customText) {
                showNotification('Please enter some text first', 'error');
                return;
            }
            
            if (customText.split(/\s+/).length < 50) {
                showNotification('Text should be at least 50 words for accurate testing', 'warning');
            }
            
            document.getElementById('customDisplayText').textContent = customText;
            document.getElementById('customTextDisplay').classList.remove('hidden');
            
            document.getElementById('testText1').textContent = customText;
            document.getElementById('testText2').innerHTML = convertToBionic(customText);
            
            currentTestText = customText;
            currentWordCount = customText.split(/\s+/).length;
        };

        window.startTimer = function(step) {
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            const timer = document.getElementById(`timer${step}`);
            
            startBtn.disabled = true;
            finishBtn.disabled = false;
            
            testStartTimes[step] = Date.now();
            
            testTimers[step] = setInterval(() => {
                const elapsed = Date.now() - testStartTimes[step];
                const seconds = Math.floor(elapsed / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        };

        window.finishTimer = function(step) {
            if (!testTimers[step]) return;
            
            clearInterval(testTimers[step]);
            testTimers[step] = null;
            
            const elapsed = Date.now() - testStartTimes[step];
            const minutes = elapsed / 60000;
            const wordsPerMinute = Math.round(currentWordCount / minutes);
            
            if (step === 1) {
                testResults.normal = wordsPerMinute;
                document.getElementById('testStep2').classList.remove('hidden');
                document.getElementById('testStep2').scrollIntoView({ behavior: 'smooth' });
            } else {
                testResults.bionic = wordsPerMinute;
                showTestResults();
            }
            
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            startBtn.disabled = false;
            finishBtn.disabled = true;
        };

        window.resetTest = function() {
            Object.keys(testTimers).forEach(key => {
                if (testTimers[key]) {
                    clearInterval(testTimers[key]);
                    testTimers[key] = null;
                }
            });
            
            document.getElementById('testStep2').classList.add('hidden');
            document.getElementById('testResults').classList.add('hidden');
            
            document.getElementById('timer1').textContent = '00:00';
            document.getElementById('timer2').textContent = '00:00';
            
            document.getElementById('startBtn1').disabled = false;
            document.getElementById('finishBtn1').disabled = true;
            document.getElementById('startBtn2').disabled = false;
            document.getElementById('finishBtn2').disabled = true;
            
            testResults = { normal: 0, bionic: 0 };
            
            document.getElementById('testStep1').scrollIntoView({ behavior: 'smooth' });
        };

        window.downloadResults = function() {
            const results = {
                date: new Date().toLocaleDateString(),
                normalSpeed: testResults.normal,
                bionicSpeed: testResults.bionic,
                improvement: testResults.bionic > testResults.normal ? 
                    Math.round(((testResults.bionic - testResults.normal) / testResults.normal) * 100) : 0
            };
            
            const report = `
BionicText AI - Reading Speed Test Results
==========================================

Test Date: ${results.date}
Text Word Count: ${currentWordCount} words

Results:
--------
Normal Text Speed: ${results.normalSpeed} WPM
BionicText Speed: ${results.bionicSpeed} WPM
Speed Improvement: +${results.improvement}%

Analysis:
---------
${results.improvement > 0 ? 
    `Congratulations! You read ${results.improvement}% faster with BionicText formatting.` :
    'Keep practicing! BionicText can help improve your reading speed over time.'
}

Generated by BionicText AI
            `.trim();
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-results-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        // Converter functions
        window.setInputMode = function(mode) {
            const buttons = document.querySelectorAll('.input-mode-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            
            const modes = document.querySelectorAll('.input-mode');
            modes.forEach(m => m.classList.add('hidden'));
            
            document.getElementById(mode + 'InputMode').classList.remove('hidden');
        };

        window.handleFileUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                document.getElementById('inputText').value = text;
                showNotification('File loaded successfully!', 'success');
            };
            reader.readAsText(file);
        };

        window.toggleVoiceRecording = function() {
            if (!recognition) {
                showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        };

        window.convertText = function() {
            let inputText = '';
            
            const activeMode = document.querySelector('.input-mode:not(.hidden)');
            if (activeMode.id === 'textInputMode') {
                inputText = document.getElementById('inputText').value.trim();
            } else if (activeMode.id === 'customTextMode') {
                inputText = document.getElementById('customTestText').value.trim();
            }
            
            if (!inputText) {
                showNotification('Please enter some text to convert', 'error');
                return;
            }
            
            const bionicText = convertToBionic(inputText);
            document.getElementById('bionicOutput').innerHTML = bionicText;
            
            showNotification('Text converted to BionicText format!', 'success');
        };

        window.updateFontSize = function() {
            const fontSize = document.getElementById('fontSize').value;
            document.getElementById('bionicOutput').style.fontSize = fontSize + 'px';
        };

        window.updateFontFamily = function() {
            const fontFamily = document.getElementById('fontFamily').value;
            document.getElementById('bionicOutput').style.fontFamily = fontFamily;
        };

        window.exportToPDF = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to export. Convert some text first!', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('BionicText exported successfully!', 'success');
        };

        window.exportToTXT = function() {
            exportToPDF();
        };

        window.speakText = function() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to speak. Convert some text first!', 'error');
                return;
            }
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(content);
                const language = document.getElementById('voiceLanguage').value;
                const speed = parseFloat(document.getElementById('voiceSpeed').value);
                
                utterance.lang = language;
                utterance.rate = speed;
                
                speechSynthesis.speak(utterance);
                showNotification('Speaking text...', 'info');
            } else {
                showNotification('Text-to-speech not supported in this browser', 'error');
            }
        };

        // AI Assistant functions
        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessageToChat('user', message);
            input.value = '';
            
            setTimeout(() => {
                const response = generateAIResponse(message);
                addMessageToChat('ai', response);
            }, 1000);
        };

        window.sendQuickMessage = function(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        };

        window.clearChat = function() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
                        <p class="text-gray-800" data-translate="assistant_welcome">Hello! I'm your BionicText AI Assistant.</p>
                    </div>
                </div>
            `;
        };

        window.handleChatKeyPress = function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        };

        // Profile functions
        window.exportAllData = function() {
            const testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
            
            if (testData.length === 0) {
                showNotification(translations[currentLanguage].notif_no_data_export, 'warning');
                return;
            }
            
            const csvContent = [
                'Date,Normal WPM,BionicText WPM,Improvement %,Text Type,Word Count',
                ...testData.map(test => 
                    `${new Date(test.date).toLocaleDateString()},${test.normalWPM},${test.bionicWPM},${test.improvement},${test.textType},${test.wordCount}`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        };

        window.deleteAllData = async function() {
            if (confirm('Are you sure you want to delete all your test data? This cannot be undone.')) {
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const userData = JSON.parse(currentUser);
                    await deleteAllDataFromFirebase(userData.uid);
                } else {
                    localStorage.removeItem('userTestData');
                    loadProfileData();
                    showNotification(translations[currentLanguage].notif_data_deleted, 'success');
                }
            }
        };

        window.hideNotification = function() {
            document.getElementById('notification').classList.add('hidden');
        };

        // Language functions
        function changeLanguage() {
            const selector = document.getElementById('languageSelector');
            currentLanguage = selector.value;
            
            // Update speech recognition language
            if (recognition) {
                recognition.lang = currentLanguage === 'tr' ? 'tr-TR' : currentLanguage === 'it' ? 'it-IT' : 'en-US';
            }
            
            // Update all translatable elements
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Update placeholder texts
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            // Update preset text if needed
            loadPresetText();
        }

        // Authentication functions
        function showAuth() {
            document.getElementById('authModal').classList.remove('hidden');
        }

        function closeAuth() {
            document.getElementById('authModal').classList.add('hidden');
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
        }

        function toggleAuthMode() {
            // This would toggle between sign in and sign up modes
            // For now, we'll just show a simple login
        }

        function login() {
            // Simple mock login - in a real app, this would connect to a backend
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            
            if (email && password) {
                // Mock successful login
                const userData = {
                    email: email,
                    name: email.split('@')[0],
                    joinDate: new Date().toISOString().split('T')[0]
                };
                
                localStorage.setItem('currentUser', JSON.stringify(userData));
                updateUIForLoggedInUser(userData);
                closeAuth();
                showNotification(translations[currentLanguage].notif_login_success, 'success');
            } else {
                showNotification(translations[currentLanguage].notif_login_failed + 'Please fill in all fields', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            updateUIForLoggedOutUser();
            showNotification('Successfully logged out', 'info');
        }

        function updateUIForLoggedInUser(userData) {
            // Hide login button, show user menu
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            
            // Update user info in navigation
            const initials = userData.name.charAt(0).toUpperCase();
            document.getElementById('userInitialsNav').textContent = initials;
            document.getElementById('userNameNav').textContent = userData.name;
            
            // Update dropdown info
            document.getElementById('userInitialsDropdown').textContent = initials;
            document.getElementById('userNameDropdown').textContent = userData.name;
            document.getElementById('userEmailDropdown').textContent = userData.email;
        }

        function updateUIForLoggedOutUser() {
            // Show login button, hide user menu
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
            closeProfileMenu();
        }

        function toggleProfileMenu() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('hidden');
        }

        function closeProfileMenu() {
            document.getElementById('profileDropdown').classList.add('hidden');
        }

        // Test functions
        function setTestTextMode(mode) {
            // Update button styles
            const buttons = document.querySelectorAll('.test-text-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            
            // Show/hide modes
            const modes = document.querySelectorAll('.test-text-mode');
            modes.forEach(m => m.classList.add('hidden'));
            
            document.getElementById(mode + 'TextMode').classList.remove('hidden');
        }

        function loadPresetText() {
            const select = document.getElementById('presetTextSelect');
            const textType = select.value;
            const textContent = presetTexts[currentLanguage] && presetTexts[currentLanguage][textType] 
                ? presetTexts[currentLanguage][textType] 
                : presetTexts.en[textType];
            
            document.getElementById('testText1').textContent = textContent;
            currentTestText = textContent;
            currentWordCount = textContent.split(/\s+/).length;
            
            // Update BionicText version
            document.getElementById('testText2').innerHTML = convertToBionic(textContent);
        }

        function updateCustomWordCount() {
            const textarea = document.getElementById('customTestText');
            const text = textarea.value.trim();
            const wordCount = text ? text.split(/\s+/).length : 0;
            document.getElementById('customWordCount').textContent = wordCount;
        }

        function loadCustomText() {
            const customText = document.getElementById('customTestText').value.trim();
            if (!customText) {
                showNotification('Please enter some text first', 'error');
                return;
            }
            
            if (customText.split(/\s+/).length < 50) {
                showNotification('Text should be at least 50 words for accurate testing', 'warning');
            }
            
            // Show custom text display
            document.getElementById('customDisplayText').textContent = customText;
            document.getElementById('customTextDisplay').classList.remove('hidden');
            
            // Update test texts
            document.getElementById('testText1').textContent = customText;
            document.getElementById('testText2').innerHTML = convertToBionic(customText);
            
            currentTestText = customText;
            currentWordCount = customText.split(/\s+/).length;
        }

        function startTimer(step) {
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            const timer = document.getElementById(`timer${step}`);
            
            startBtn.disabled = true;
            finishBtn.disabled = false;
            
            testStartTimes[step] = Date.now();
            
            testTimers[step] = setInterval(() => {
                const elapsed = Date.now() - testStartTimes[step];
                const seconds = Math.floor(elapsed / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function finishTimer(step) {
            if (!testTimers[step]) return;
            
            clearInterval(testTimers[step]);
            testTimers[step] = null;
            
            const elapsed = Date.now() - testStartTimes[step];
            const minutes = elapsed / 60000; // Convert to minutes
            const wordsPerMinute = Math.round(currentWordCount / minutes);
            
            if (step === 1) {
                testResults.normal = wordsPerMinute;
                // Show step 2
                document.getElementById('testStep2').classList.remove('hidden');
                document.getElementById('testStep2').scrollIntoView({ behavior: 'smooth' });
            } else {
                testResults.bionic = wordsPerMinute;
                showTestResults();
            }
            
            // Reset buttons
            const startBtn = document.getElementById(`startBtn${step}`);
            const finishBtn = document.getElementById(`finishBtn${step}`);
            startBtn.disabled = false;
            finishBtn.disabled = true;
        }

        function showTestResults() {
            const normalWPM = testResults.normal;
            const bionicWPM = testResults.bionic;
            const improvement = bionicWPM > normalWPM ? 
                Math.round(((bionicWPM - normalWPM) / normalWPM) * 100) : 0;
            
            document.getElementById('normalWPM').textContent = normalWPM;
            document.getElementById('bionicWPM').textContent = bionicWPM;
            document.getElementById('improvement').textContent = `+${improvement}%`;
            
            // Update progress bar
            const progressBar = document.getElementById('progressBar');
            const maxImprovement = 100; // Max expected improvement for progress bar
            const progressWidth = Math.min((improvement / maxImprovement) * 100, 100);
            progressBar.style.width = `${progressWidth}%`;
            
            // Save test results
            saveTestResults({
                date: new Date().toISOString(),
                normalWPM: normalWPM,
                bionicWPM: bionicWPM,
                improvement: improvement,
                textType: document.getElementById('presetTextSelect').value,
                wordCount: currentWordCount
            });
            
            // Show results section
            document.getElementById('testResults').classList.remove('hidden');
            document.getElementById('testResults').scrollIntoView({ behavior: 'smooth' });
        }

        function resetTest() {
            // Reset all timers
            Object.keys(testTimers).forEach(key => {
                if (testTimers[key]) {
                    clearInterval(testTimers[key]);
                    testTimers[key] = null;
                }
            });
            
            // Reset UI
            document.getElementById('testStep2').classList.add('hidden');
            document.getElementById('testResults').classList.add('hidden');
            
            // Reset timers display
            document.getElementById('timer1').textContent = '00:00';
            document.getElementById('timer2').textContent = '00:00';
            
            // Reset buttons
            document.getElementById('startBtn1').disabled = false;
            document.getElementById('finishBtn1').disabled = true;
            document.getElementById('startBtn2').disabled = false;
            document.getElementById('finishBtn2').disabled = true;
            
            // Reset results
            testResults = { normal: 0, bionic: 0 };
            
            // Scroll to top
            document.getElementById('testStep1').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadResults() {
            const results = {
                date: new Date().toLocaleDateString(),
                normalSpeed: testResults.normal,
                bionicSpeed: testResults.bionic,
                improvement: testResults.bionic > testResults.normal ? 
                    Math.round(((testResults.bionic - testResults.normal) / testResults.normal) * 100) : 0
            };
            
            // Create a simple text report
            const report = `
BionicText AI - Reading Speed Test Results
==========================================

Test Date: ${results.date}
Text Word Count: ${currentWordCount} words

Results:
--------
Normal Text Speed: ${results.normalSpeed} WPM
BionicText Speed: ${results.bionicSpeed} WPM
Speed Improvement: +${results.improvement}%

Analysis:
---------
${results.improvement > 0 ? 
    `Congratulations! You read ${results.improvement}% faster with BionicText formatting.` :
    'Keep practicing! BionicText can help improve your reading speed over time.'
}

Generated by BionicText AI
Visit: https://bionictext.ai
            `.trim();
            
            // Download as text file
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-results-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        }

        // Converter functions
        function setInputMode(mode) {
            // Update button styles
            const buttons = document.querySelectorAll('.input-mode-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            
            // Show/hide modes
            const modes = document.querySelectorAll('.input-mode');
            modes.forEach(m => m.classList.add('hidden'));
            
            document.getElementById(mode + 'InputMode').classList.remove('hidden');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                document.getElementById('inputText').value = text;
                showNotification('File loaded successfully!', 'success');
            };
            reader.readAsText(file);
        }

        function toggleVoiceRecording() {
            if (!recognition) {
                showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            isRecording = true;
            document.getElementById('recordingStatus').classList.remove('hidden');
            document.getElementById('micIcon').style.color = '#ef4444';
            recognition.start();
        }

        function stopRecording() {
            isRecording = false;
            document.getElementById('recordingStatus').classList.add('hidden');
            document.getElementById('micIcon').style.color = 'white';
            if (recognition) {
                recognition.stop();
            }
        }

        function convertText() {
            let inputText = '';
            
            // Get text from active input mode
            const activeMode = document.querySelector('.input-mode:not(.hidden)');
            if (activeMode.id === 'textInputMode') {
                inputText = document.getElementById('inputText').value.trim();
            } else if (activeMode.id === 'customTextMode') {
                inputText = document.getElementById('customTestText').value.trim();
            }
            
            if (!inputText) {
                showNotification('Please enter some text to convert', 'error');
                return;
            }
            
            const bionicText = convertToBionic(inputText);
            document.getElementById('bionicOutput').innerHTML = bionicText;
            
            showNotification('Text converted to BionicText format!', 'success');
        }

        function convertToBionic(text) {
            // Get bold intensity setting (default 50%)
            const intensity = parseInt(localStorage.getItem('boldIntensity') || '50');
            
            return text.split(' ').map(word => {
                if (word.length <= 1) return word;
                
                // Turkish character support - preserve all non-space characters
                const letterRegex = /[\wÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ã‡ÄžÄ°Ã–ÅžÃœ]/g;
                const nonLetterRegex = /[^\wÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ã‡ÄžÄ°Ã–ÅžÃœ]/g;
                
                const letters = word.match(letterRegex);
                const nonLetters = word.match(nonLetterRegex);
                
                if (!letters || letters.length <= 1) return word;
                
                // Calculate bold length based on intensity setting
                const boldLength = Math.max(1, Math.ceil(letters.length * (intensity / 100)));
                
                let result = '';
                let letterIndex = 0;
                
                // Reconstruct word with proper bold formatting
                for (let char of word) {
                    if (/[\wÃ§ÄŸÄ±Ã¶ÅŸÃ¼Ã‡ÄžÄ°Ã–ÅžÃœ]/.test(char)) {
                        if (letterIndex < boldLength) {
                            if (letterIndex === 0) {
                                result += `<span class="bionic-bold">${char}`;
                            } else {
                                result += char;
                            }
                            if (letterIndex === boldLength - 1) {
                                result += '</span>';
                            }
                        } else {
                            result += char;
                        }
                        letterIndex++;
                    } else {
                        result += char;
                    }
                }
                
                // Close span if still open
                if (letterIndex === boldLength && !result.includes('</span>')) {
                    result += '</span>';
                }
                
                return result;
            }).join(' ');
        }

        function updateFontSize() {
            const fontSize = document.getElementById('fontSize').value;
            document.getElementById('bionicOutput').style.fontSize = fontSize + 'px';
        }

        function updateFontFamily() {
            const fontFamily = document.getElementById('fontFamily').value;
            document.getElementById('bionicOutput').style.fontFamily = fontFamily;
        }

        function exportToPDF() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to export. Convert some text first!', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('BionicText exported successfully!', 'success');
        }

        function exportToTXT() {
            exportToPDF(); // Same functionality for now
        }

        function speakText() {
            const content = document.getElementById('bionicOutput').innerText;
            if (!content || content.includes('Your converted BionicText will appear here')) {
                showNotification('No text to speak. Convert some text first!', 'error');
                return;
            }
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(content);
                const language = document.getElementById('voiceLanguage').value;
                const speed = parseFloat(document.getElementById('voiceSpeed').value);
                
                utterance.lang = language;
                utterance.rate = speed;
                
                speechSynthesis.speak(utterance);
                showNotification('Speaking text...', 'info');
            } else {
                showNotification('Text-to-speech not supported in this browser', 'error');
            }
        }

        // AI Assistant functions
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessageToChat('user', message);
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addMessageToChat('ai', response);
            }, 1000);
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function addMessageToChat(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-sm font-semibold">U</span>
                    </div>
                    <div class="bg-primary text-white rounded-lg p-3 shadow-sm max-w-md">
                        <p>${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
                        <p class="text-gray-800">${message}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('bionic') || lowerMessage.includes('what is')) {
                return 'BionicText is a reading method that bolds the first part of words to help your eyes focus and increase reading speed. Studies show it can improve reading speed by up to 200% while maintaining comprehension.';
            } else if (lowerMessage.includes('improve') || lowerMessage.includes('speed')) {
                return 'To improve your reading speed: 1) Practice regularly with BionicText, 2) Minimize subvocalization (inner voice), 3) Use your finger as a guide, 4) Read in chunks rather than word by word, 5) Take regular reading tests to track progress.';
            } else if (lowerMessage.includes('statistics') || lowerMessage.includes('stats')) {
                const userData = JSON.parse(localStorage.getItem('userTestData') || '[]');
                if (userData.length === 0) {
                    return 'You haven\'t taken any reading tests yet! Take your first test to start tracking your progress.';
                }
                const avgNormal = userData.reduce((sum, test) => sum + test.normalWPM, 0) / userData.length;
                const avgBionic = userData.reduce((sum, test) => sum + test.bionicWPM, 0) / userData.length;
                return `Based on your ${userData.length} tests: Average normal speed is ${Math.round(avgNormal)} WPM, average BionicText speed is ${Math.round(avgBionic)} WPM. You're improving!`;
            } else if (lowerMessage.includes('benefits')) {
                return 'Speed reading benefits include: Better time management, increased productivity, improved focus and concentration, enhanced comprehension skills, reduced eye strain, and the ability to process more information quickly.';
            } else {
                return 'That\'s an interesting question! I\'m here to help with BionicText, reading techniques, and analyzing your reading performance. Feel free to ask about improving your reading speed or take a reading test to get personalized insights.';
            }
        }

        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-md">
                        <p class="text-gray-800" data-translate="assistant_welcome">Hello! I'm your BionicText AI Assistant. I can help you with:</p>
                        <ul class="mt-2 text-sm text-gray-600 space-y-1">
                            <li data-translate="assistant_help_1">â€¢ Questions about BionicText and speed reading</li>
                            <li data-translate="assistant_help_2">â€¢ Analysis of your reading performance</li>
                            <li data-translate="assistant_help_3">â€¢ Tips to improve your reading speed</li>
                            <li data-translate="assistant_help_4">â€¢ General questions about anything!</li>
                        </ul>
                        <p class="mt-2 text-sm text-gray-500" data-translate="assistant_ask">What would you like to know?</p>
                    </div>
                </div>
            `;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Profile and data functions
        function loadUserData() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const userData = JSON.parse(currentUser);
                updateUIForLoggedInUser(userData);
            }
        }

        function loadProfileData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
            
            if (currentUser.name) {
                document.getElementById('profileUserName').textContent = currentUser.name;
                document.getElementById('profileUserEmail').textContent = currentUser.email;
                document.getElementById('memberSince').textContent = currentUser.joinDate || 'Today';
                document.getElementById('userInitials').textContent = currentUser.name.charAt(0).toUpperCase();
            }
            
            document.getElementById('totalTests').textContent = testData.length;
            
            if (testData.length > 0) {
                const avgNormal = Math.round(testData.reduce((sum, test) => sum + test.normalWPM, 0) / testData.length);
                const avgBionic = Math.round(testData.reduce((sum, test) => sum + test.bionicWPM, 0) / testData.length);
                const avgImprovement = Math.round(testData.reduce((sum, test) => sum + test.improvement, 0) / testData.length);
                const bestImprovement = testData.length > 0 ? Math.max(...testData.map(test => test.improvement)) : 0;
                
                document.getElementById('avgNormalSpeed').textContent = avgNormal;
                document.getElementById('avgBionicSpeed').textContent = avgBionic;
                document.getElementById('avgImprovement').textContent = avgImprovement + '%';
                document.getElementById('bestImprovement').textContent = bestImprovement + '%';
                
                // Load recent tests
                loadRecentTests(testData);
            }
        }

        function loadRecentTests(testData) {
            const recentTestsContainer = document.getElementById('recentTests');
            
            if (testData.length === 0) {
                recentTestsContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <p>No test results yet. Take your first reading speed test!</p>
                        <button onclick="showSection('test')" class="mt-2 text-primary hover:text-blue-800 font-medium">Start Test</button>
                    </div>
                `;
                return;
            }
            
            const recentTests = testData.slice(-5).reverse();
            recentTestsContainer.innerHTML = recentTests.map(test => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium text-gray-800">${new Date(test.date).toLocaleDateString()}</div>
                        <div class="text-sm text-gray-600">${test.wordCount} words â€¢ ${test.textType}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold text-primary">${test.bionicWPM} WPM</div>
                        <div class="text-sm text-green-600">+${test.improvement}%</div>
                    </div>
                </div>
            `).join('');
            
            // Draw progress chart
            drawProgressChart(testData);
        }
        
        function drawProgressChart(testData) {
            const canvas = document.getElementById('progressChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            if (testData.length === 0) {
                ctx.fillStyle = '#9ca3af';
                ctx.font = '14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('No data yet', width / 2, height / 2);
                return;
            }
            
            // Get last 10 tests
            const recentTests = testData.slice(-10);
            const maxWPM = Math.max(...recentTests.map(t => Math.max(t.normalWPM, t.bionicWPM))) + 50;
            
            // Chart dimensions
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // Draw axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw grid lines
            ctx.strokeStyle = '#f3f4f6';
            ctx.lineWidth = 0.5;
            for (let i = 1; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // Draw Y-axis labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Inter';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = Math.round((maxWPM / 5) * (5 - i));
                const y = padding + (chartHeight / 5) * i;
                ctx.fillText(value + ' WPM', padding - 10, y + 4);
            }
            
            // Function to calculate point position
            function getX(index) {
                return padding + (chartWidth / (recentTests.length - 1 || 1)) * index;
            }
            
            function getY(wpm) {
                return height - padding - (wpm / maxWPM) * chartHeight;
            }
            
            // Draw Normal WPM line
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 2;
            ctx.beginPath();
            recentTests.forEach((test, i) => {
                const x = getX(i);
                const y = getY(test.normalWPM);
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw Normal WPM points
            ctx.fillStyle = '#6b7280';
            recentTests.forEach((test, i) => {
                const x = getX(i);
                const y = getY(test.normalWPM);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw BionicText WPM line
            ctx.strokeStyle = '#1a2b4c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            recentTests.forEach((test, i) => {
                const x = getX(i);
                const y = getY(test.bionicWPM);
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw BionicText WPM points
            ctx.fillStyle = '#1a2b4c';
            recentTests.forEach((test, i) => {
                const x = getX(i);
                const y = getY(test.bionicWPM);
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw legend
            const legendY = 20;
            ctx.fillStyle = '#6b7280';
            ctx.fillRect(width - 150, legendY, 20, 3);
            ctx.fillStyle = '#4b5563';
            ctx.font = '12px Inter';
            ctx.textAlign = 'left';
            ctx.fillText('Normal Text', width - 125, legendY + 5);
            
            ctx.fillStyle = '#1a2b4c';
            ctx.fillRect(width - 150, legendY + 20, 20, 3);
            ctx.fillStyle = '#1a2b4c';
            ctx.fillText('BionicText', width - 125, legendY + 25);
        }

        async function saveTestResults(results) {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                showNotification(translations[currentLanguage].notif_signin_to_save, 'warning');
                return;
            }
            
            const userData = JSON.parse(currentUser);
            
            try {
                // Save to Firebase
                await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDb, 'testResults'), {
                    userId: userData.uid,
                    ...results,
                    timestamp: new Date().toISOString()
                });
                
                // Also save to localStorage for offline access
                let testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
                testData.push(results);
                localStorage.setItem('userTestData', JSON.stringify(testData));
                
                showNotification(translations[currentLanguage].notif_test_saved, 'success');
            } catch (error) {
                console.error('Error saving test results:', error);
                showNotification('Error saving results to cloud', 'error');
            }
        }

        function exportAllData() {
            const testData = JSON.parse(localStorage.getItem('userTestData') || '[]');
            
            if (testData.length === 0) {
                showNotification(translations[currentLanguage].notif_no_data_export, 'warning');
                return;
            }
            
            const csvContent = [
                'Date,Normal WPM,BionicText WPM,Improvement %,Text Type,Word Count',
                ...testData.map(test => 
                    `${new Date(test.date).toLocaleDateString()},${test.normalWPM},${test.bionicWPM},${test.improvement},${test.textType},${test.wordCount}`
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bionictext-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(translations[currentLanguage].notif_data_exported, 'success');
        }

        function deleteAllData() {
            if (confirm('Are you sure you want to delete all your test data? This cannot be undone.')) {
                localStorage.removeItem('userTestData');
                loadProfileData();
                showNotification(translations[currentLanguage].notif_data_deleted, 'success');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const notificationIcon = document.getElementById('notificationIcon');
            
            notificationText.textContent = message;
            
            // Update icon and colors based on type
            const iconColors = {
                success: 'text-green-500',
                error: 'text-red-500',
                warning: 'text-yellow-500',
                info: 'text-blue-500'
            };
            
            notificationIcon.className = `w-5 h-5 ${iconColors[type] || iconColors.info}`;
            
            notification.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.add('hidden');
        }



        // Settings functions
        window.updateGlobalFontSize = function(value) {
            document.getElementById('fontSizeValue').textContent = value + 'px';
            document.getElementById('previewText').style.fontSize = value + 'px';
            localStorage.setItem('globalFontSize', value);
            applyGlobalSettings();
        };

        window.updateGlobalLineHeight = function(value) {
            document.getElementById('lineHeightValue').textContent = value;
            document.getElementById('previewText').style.lineHeight = value;
            localStorage.setItem('globalLineHeight', value);
            applyGlobalSettings();
        };

        window.updateBoldIntensity = function(value) {
            document.getElementById('boldIntensityValue').textContent = value + '%';
            localStorage.setItem('boldIntensity', value);
            
            // Update preview
            const sampleText = currentLanguage === 'tr' ? 
                'Bu biyonik metin Ã¶rneÄŸidir. KalÄ±n harfler okuma hÄ±zÄ±nÄ±zÄ± artÄ±rÄ±r.' :
                'This is a bionic text example. Bold letters increase your reading speed.';
            document.getElementById('bionicPreview').innerHTML = convertToBionic(sampleText);
        };

        window.setTheme = function(theme) {
            const body = document.body;
            const themeButtons = document.querySelectorAll('.theme-btn');
            
            // Remove all theme classes
            body.classList.remove('theme-light', 'theme-dark', 'theme-sepia');
            
            // Add selected theme
            body.classList.add('theme-' + theme);
            localStorage.setItem('theme', theme);
            
            // Update button styles
            themeButtons.forEach(btn => {
                btn.classList.remove('border-primary');
                btn.classList.add('border-gray-300');
            });
            event.target.closest('.theme-btn').classList.remove('border-gray-300');
            event.target.closest('.theme-btn').classList.add('border-primary');
            
            // Apply theme colors
            if (theme === 'dark') {
                body.style.backgroundColor = '#1a1a1a';
                body.style.color = '#ffffff';
            } else if (theme === 'sepia') {
                body.style.backgroundColor = '#f4ecd8';
                body.style.color = '#5c4a3a';
            } else {
                body.style.backgroundColor = '#f9fafb';
                body.style.color = '#111827';
            }
        };

        window.resetSettings = function() {
            if (confirm('TÃ¼m ayarlarÄ± varsayÄ±lan deÄŸerlere sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?')) {
                localStorage.removeItem('globalFontSize');
                localStorage.removeItem('globalLineHeight');
                localStorage.removeItem('boldIntensity');
                localStorage.removeItem('theme');
                localStorage.removeItem('readingGuide');
                localStorage.removeItem('autoScroll');
                
                // Reset UI
                document.getElementById('globalFontSize').value = 18;
                document.getElementById('globalLineHeight').value = 1.6;
                document.getElementById('boldIntensity').value = 50;
                document.getElementById('readingGuide').checked = false;
                document.getElementById('autoScroll').checked = false;
                
                updateGlobalFontSize(18);
                updateGlobalLineHeight(1.6);
                updateBoldIntensity(50);
                setTheme('light');
                
                showNotification('Ayarlar varsayÄ±lan deÄŸerlere sÄ±fÄ±rlandÄ±', 'success');
            }
        };

        window.toggleReadingGuide = function() {
            const enabled = document.getElementById('readingGuide').checked;
            localStorage.setItem('readingGuide', enabled);
            // Implementation for reading guide would go here
        };

        window.toggleAutoScroll = function() {
            const enabled = document.getElementById('autoScroll').checked;
            localStorage.setItem('autoScroll', enabled);
            // Implementation for auto-scroll would go here
        };

        function applyGlobalSettings() {
            const fontSize = localStorage.getItem('globalFontSize') || '18';
            const lineHeight = localStorage.getItem('globalLineHeight') || '1.6';
            
            // Apply to test sections
            const testTexts = document.querySelectorAll('#testText1, #testText2, #bionicOutput');
            testTexts.forEach(el => {
                el.style.fontSize = fontSize + 'px';
                el.style.lineHeight = lineHeight;
            });
        }

        function loadSettings() {
            // Load font size
            const fontSize = localStorage.getItem('globalFontSize') || '18';
            document.getElementById('globalFontSize').value = fontSize;
            updateGlobalFontSize(fontSize);
            
            // Load line height
            const lineHeight = localStorage.getItem('globalLineHeight') || '1.6';
            document.getElementById('globalLineHeight').value = lineHeight;
            updateGlobalLineHeight(lineHeight);
            
            // Load bold intensity
            const boldIntensity = localStorage.getItem('boldIntensity') || '50';
            document.getElementById('boldIntensity').value = boldIntensity;
            updateBoldIntensity(boldIntensity);
            
            // Load theme
            const theme = localStorage.getItem('theme') || 'light';
            const themeButton = document.querySelector(`button[onclick="setTheme('${theme}')"]`);
            if (themeButton) {
                themeButton.classList.add('border-primary');
                themeButton.classList.remove('border-gray-300');
            }
            
            // Load reading settings
            const readingGuide = localStorage.getItem('readingGuide') === 'true';
            const autoScroll = localStorage.getItem('autoScroll') === 'true';
            if (document.getElementById('readingGuide')) {
                document.getElementById('readingGuide').checked = readingGuide;
            }
            if (document.getElementById('autoScroll')) {
                document.getElementById('autoScroll').checked = autoScroll;
            }
            
            applyGlobalSettings();
        }

        // Click outside to close profile menu
        document.addEventListener('click', function(event) {
            const profileMenu = document.getElementById('userMenu');
            const profileDropdown = document.getElementById('profileDropdown');
            
            if (profileMenu && profileDropdown && !profileMenu.contains(event.target)) {
                profileDropdown.classList.add('hidden');
            }
        });
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a5af8cd72e4d606',t:'MTc2NDM0NDUxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
